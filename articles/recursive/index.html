<!DOCTYPE html>
<html lang="en" style="scroll-behavior: smooth;">
  <head>
  <meta charset="UTF-8">
  <meta name="description" content="Astro description">
  <meta name="viewport" content="width=device-width">
  <meta name="generator" content="Astro v2.10.14">

  <link rel="icon" type="image/svg+xml" href="/favicon.svg">

  <link rel="stylesheet" href="../../node_modules/@picocss/pico/css/pico.css">

  <title>Recursive | Alexander&#39;s public</title>

  <!-- svgbob style -->
  

  <!-- icons -->
  

  
<link rel="stylesheet" href="/_astro/index.52b67c08.css" />
<link rel="stylesheet" href="/_astro/_...slug_.dfeb62d8.css" /><script type="module">document.querySelectorAll("*[data-icon-name]").forEach(e=>{const t=e,o=document.createElement("img");o.src=`/icons/${t.dataset.iconName}.svg`,t.prepend(o)});const n=document.getElementById("splash");if(n===null)throw"something's wrong";const s=`${window.location.origin}${window.location.pathname}${window.location.search}#`;document.querySelectorAll("a").forEach(e=>{e.href.startsWith(s)||(e.onclick=async t=>{t.preventDefault(),t.stopPropagation(),n.open=!0,n.classList.remove("hidden"),n.classList.add("visible"),await new Promise(o=>setTimeout(o,666)),location.assign(e.href)})});
</script><script src="/_astro/Code.astro_astro_type_script_index_0_lang.7b42aa70.js" type="module"></script></head>


  <body>
    <dialog id="splash" open class="hidden astro-MLBAG6B5" aria-busy="true">
</dialog>
    <main class="container">
      
  <aside class="astro-SSFZSV2F">
  
    <ul class="astro-OBEWOZ47">
  <li class="astro-OBEWOZ47">
        <a href="#every-thing-originates-from-a-loop" class="astro-OBEWOZ47">Every Thing Originates From a Loop …</a>
        
      </li><li class="astro-OBEWOZ47">
        <a href="#concept" class="astro-OBEWOZ47">Concept</a>
        <ul class="astro-OBEWOZ47">
  <li class="astro-OBEWOZ47">
        <a href="#why-motivation" class="astro-OBEWOZ47">Why? (Motivation)</a>
        <ul class="astro-OBEWOZ47">
  <li class="astro-OBEWOZ47">
        <a href="#why-public" class="astro-OBEWOZ47">why Public?</a>
        
      </li>
</ul>
      </li><li class="astro-OBEWOZ47">
        <a href="#structure" class="astro-OBEWOZ47">Structure</a>
        
      </li>
</ul>
      </li><li class="astro-OBEWOZ47">
        <a href="#manifestation" class="astro-OBEWOZ47">Manifestation</a>
        <ul class="astro-OBEWOZ47">
  <li class="astro-OBEWOZ47">
        <a href="#base" class="astro-OBEWOZ47">Base</a>
        <ul class="astro-OBEWOZ47">
  <li class="astro-OBEWOZ47">
        <a href="#tools" class="astro-OBEWOZ47">Tools</a>
        <ul class="astro-OBEWOZ47">
  <li class="astro-OBEWOZ47">
        <a href="#engine" class="astro-OBEWOZ47">Engine</a>
        
      </li><li class="astro-OBEWOZ47">
        <a href="#platform" class="astro-OBEWOZ47">Platform</a>
        
      </li>
</ul>
      </li>
</ul>
      </li><li class="astro-OBEWOZ47">
        <a href="#features" class="astro-OBEWOZ47">Features</a>
        <ul class="astro-OBEWOZ47">
  <li class="astro-OBEWOZ47">
        <a href="#display-content" class="astro-OBEWOZ47">Display Content</a>
        <ul class="astro-OBEWOZ47">
  <li class="astro-OBEWOZ47">
        <a href="#diagrams" class="astro-OBEWOZ47">Diagrams</a>
        <ul class="astro-OBEWOZ47">
  <li class="astro-OBEWOZ47">
        <a href="#options" class="astro-OBEWOZ47">Options</a>
        <ul class="astro-OBEWOZ47">
  <li class="astro-OBEWOZ47">
        <a href="#mermaid" class="astro-OBEWOZ47">Mermaid</a>
        
      </li><li class="astro-OBEWOZ47">
        <a href="#graphviz" class="astro-OBEWOZ47">Graphviz</a>
        
      </li><li class="astro-OBEWOZ47">
        <a href="#svgbob" class="astro-OBEWOZ47">svgbob</a>
        
      </li>
</ul>
      </li><li class="astro-OBEWOZ47">
        <a href="#summary" class="astro-OBEWOZ47">Summary</a>
        
      </li>
</ul>
      </li><li class="astro-OBEWOZ47">
        <a href="#music-bandcamp" class="astro-OBEWOZ47">Music (Bandcamp)</a>
        
      </li>
</ul>
      </li><li class="astro-OBEWOZ47">
        <a href="#navigation-preview" class="astro-OBEWOZ47">Navigation (Preview)</a>
        <ul class="astro-OBEWOZ47">
  <li class="astro-OBEWOZ47">
        <a href="#page-types" class="astro-OBEWOZ47">Page Types</a>
        
      </li><li class="astro-OBEWOZ47">
        <a href="#display-rules" class="astro-OBEWOZ47">Display Rules</a>
        
      </li><li class="astro-OBEWOZ47">
        <a href="#preprocessing" class="astro-OBEWOZ47">Preprocessing</a>
        
      </li>
</ul>
      </li><li class="astro-OBEWOZ47">
        <a href="#feedback" class="astro-OBEWOZ47">Feedback</a>
        <ul class="astro-OBEWOZ47">
  <li class="astro-OBEWOZ47">
        <a href="#why" class="astro-OBEWOZ47">Why?</a>
        
      </li><li class="astro-OBEWOZ47">
        <a href="#how" class="astro-OBEWOZ47">How?</a>
        
      </li><li class="astro-OBEWOZ47">
        <a href="#authentication" class="astro-OBEWOZ47">Authentication</a>
        
      </li><li class="astro-OBEWOZ47">
        <a href="#github-graphql-client" class="astro-OBEWOZ47">Github GraphQL Client</a>
        <ul class="astro-OBEWOZ47">
  <li class="astro-OBEWOZ47">
        <a href="#tools-1" class="astro-OBEWOZ47">Tools</a>
        
      </li><li class="astro-OBEWOZ47">
        <a href="#client-operations" class="astro-OBEWOZ47">Client operations</a>
        <ul class="astro-OBEWOZ47">
  <li class="astro-OBEWOZ47">
        <a href="#todo" class="astro-OBEWOZ47">TODO</a>
        
      </li>
</ul>
      </li>
</ul>
      </li>
</ul>
      </li><li class="astro-OBEWOZ47">
        <a href="#fanciness" class="astro-OBEWOZ47">Fanciness</a>
        <ul class="astro-OBEWOZ47">
  <li class="astro-OBEWOZ47">
        <a href="#color-scheme-preference" class="astro-OBEWOZ47">Color Scheme Preference</a>
        
      </li>
</ul>
      </li>
</ul>
      </li>
</ul>
      </li><li class="astro-OBEWOZ47">
        <a href="#sources-of-inspiration" class="astro-OBEWOZ47">Sources of Inspiration</a>
        
      </li><li class="astro-OBEWOZ47">
        <a href="#-repeat" class="astro-OBEWOZ47">… Repeat</a>
        
      </li>
</ul>
  
  <button id="sidebar-toggle" data-icon-gmso="toc" class="astro-SSFZSV2F"></button>
</aside>

<script>(function(){const icon = "toc";

const toggles = document.querySelectorAll("#sidebar-toggle");
toggles.forEach((button) => {
  if (!(button instanceof HTMLButtonElement)) throw "wrong button";
  const parent = button.parentElement;
  if (!parent) throw "no parent";
  button.onclick = () => {
    if (parent.classList.contains("visible")) {
      parent.classList.remove("visible");
      parent.classList.add("hidden");
      button.dataset.iconGmso = icon;
    } else {
      parent.classList.remove("hidden");
      parent.classList.add("visible");
      button.dataset.iconGmso = "arrow_forward_ios";
    }
  };
});
})();</script>
  <article>
  <header>
    <hgroup>
      <h1>Recursive</h1>
      <h2>created: 8/7/2023, published: 8/31/2023</h2>
    </hgroup>
  </header>
  <main>
    <h1 id="every-thing-originates-from-a-loop">Every Thing Originates From a Loop …</h1>
<div style="display:flex;height:120px;width:300px;background-color:var(--primary-focus);justify-content:center;align-items:center">
      badncamp stub
    </div>
<p>…everything Else is a Remix.</p>
<h1 id="concept">Concept</h1>
<p>Tool to output stuff into public.</p>
<h2 id="why-motivation">Why? (Motivation)</h2>
<ul>
<li>Artistic expression</li>
<li>Blow off steam</li>
</ul>
<h3 id="why-public">why Public?</h3>
<ul>
<li>Private already exists</li>
<li>Observer effect
<ul>
<li>Experimentation</li>
</ul>
</li>
</ul>
<h2 id="structure">Structure</h2>
<ul>
<li>Display Content
<ul>
<li>Embeddings (audio, code, diagrams, pictures, video, …)</li>
<li>Navigation</li>
</ul>
</li>
<li>Feedback (comments)</li>
</ul>
<h1 id="manifestation">Manifestation</h1>
<p>Brief and Simple.</p>
<h2 id="base">Base</h2>
<p>Web Application.</p>
<h3 id="tools">Tools</h3>
<h4 id="engine">Engine</h4>
<p><a href="https://astro.build/">Astro</a>:</p>
<ul>
<li>Satisfies most of my demands</li>
<li>Provides flexibility to satisfy the rest</li>
<li>Well aligned with contemporaneity principles</li>
</ul>
<details><summary>Some alternatives</summary><ul>
<li>Other static website generators:
<ul>
<li><a href="https://docusaurus.io/">Docusaurus</a> (I don’t like React)</li>
<li><a href="https://www.gatsbyjs.com/">Gatsby</a></li>
<li><a href="https://gohugo.io/">Hugo</a></li>
</ul>
</li>
<li>Frameworks:
<ul>
<li><a href="https://rubyonrails.org/">Rails</a></li>
<li><a href="https://www.djangoproject.com/">Django</a></li>
<li><a href="https://start.solidjs.com/">Solid Start</a></li>
</ul>
</li>
<li><a href="https://www.php.net/">PHP</a> which, they say, <a href="https://www.youtube.com/results?search_query=php+doesn%27t+suck">doesn suck that much lately</a>; but I wouldn’t care</li>
</ul></details>
<h4 id="platform">Platform</h4>
<ul>
<li><a href="https://github.com/">Github</a>
<ul>
<li><a href="https://docs.github.com/en/repositories">Repositories</a> for code</li>
<li><a href="https://docs.github.com/en/pages">Pages</a> for static hosting</li>
<li><a href="https://docs.github.com/en/discussions">Discussions</a> for feedback</li>
<li><a href="https://docs.github.com/en/graphql">GraphQL</a> for integration</li>
</ul>
</li>
<li><a href="https://cloud.google.com/">Google Cloud Platform</a>
<ul>
<li><a href="https://cloud.google.com/functions/">Cloud Functions</a> for authentication</li>
</ul>
</li>
</ul>
<details><summary>Some alternatives</summary><ul>
<li>For code:
<ul>
<li><a href="https://codeberg.org/">Codeberg</a>🤗</li>
</ul>
</li>
<li>For static hosting:
<ul>
<li><a href="https://docs.codeberg.org/codeberg-pages/">Codeberg’s Pages</a></li>
<li>Netlify</li>
</ul>
</li>
<li>For Feedback:
<ul>
<li><a href="https://activitypub.rocks/">ActivityPub</a>
<ul>
<li><a href="https://github.com/mastodon/mastodon">Mastodon</a>?🤨</li>
</ul>
</li>
<li><a href="https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol">SMTP</a> 🥲</li>
</ul>
</li>
<li>Authentication
<ul>
<li>AWS Lambdas🤑</li>
</ul>
</li>
</ul></details>
<h2 id="features">Features</h2>
<h3 id="display-content">Display Content</h3>
<p>MDX format provides most of the features out of the box:</p>
<ul>
<li>Embedding pictures</li>
<li>Embedding HTML parts</li>
</ul>
<p>Some specific cases to be solved on occurrence.</p>
<h4 id="diagrams">Diagrams</h4>
<p>Structured Information Representation is often the essential for delivery of an idea.</p>
<p>I often think while moving stuff around in a <a href="https://app.diagrams.net/">draw.io</a>.</p>
<p>Diagrams within website content should be text to graphics.</p>
<h5 id="options">Options</h5>
<h6 id="mermaid">Mermaid</h6>
<p><a href="https://mermaid.js.org/">mermaid-js</a> has ready to use
<a href="https://code.juliancataldo.com/component/astro-diagram">Astro integration</a>
Thanks to <a href="https://github.com/JulianCataldo">Julian Cataldo</a>.</p>
<p>Downsides:</p>
<ul>
<li>syntax and diagrams look chaotic</li>
<li>there is very small subset of UML supported</li>
<li>almost no control over layouts</li>
<li>requires puppeteer (i.e. browser) to render text into SVG 🤦‍♂️</li>
</ul>
<p>Alternative - Remark plugin:</p>
<ul>
<li>won’t eliminate any downsides (mermaid has this complexity flow in its core)</li>
<li>there is more than one options to research</li>
</ul>
<h6 id="graphviz">Graphviz</h6>
<p>Robust Versatile C library for Complex Graph Visualizations.</p>
<p>Issues with Color Scheme Preference: in dark mode text is hardly readable.</p>
<details><summary>Example</summary><p><svg xmlns="http://www.w3.org/2000/svg" width="224pt" height="409pt" viewBox="0 0 224 409.01"><g class="graph" transform="translate(4 405.01)"><defs><linearGradient id="a" x1="108" x2="108" y1="4" y2="-405.01" gradientUnits="userSpaceOnUse"><stop offset="0" style="stop-color:#00f;stop-opacity:.266667"></stop><stop offset="1" style="stop-color:red;stop-opacity:.266667"></stop></linearGradient></defs><path fill="url(#a)" d="M-4 4v-409.01h224V4H-4z"></path><g class="cluster"><defs><linearGradient id="b" x1="8" x2="98" y1="-210.61" y2="-210.61" gradientUnits="userSpaceOnUse"><stop offset="0" style="stop-color:darkgray;stop-opacity:1."></stop><stop offset="1" style="stop-color:gold;stop-opacity:1."></stop></linearGradient></defs><path fill="url(#b)" stroke="#d3d3d3" d="M8-64.21v-292.8h90v292.8H8z"></path><text x="53" y="-340.41" font-family="Times,serif" font-size="14" text-anchor="middle">process #1</text></g><g class="cluster"><defs><linearGradient id="c" x1="133" x2="208" y1="-210.61" y2="-210.61" gradientUnits="userSpaceOnUse"><stop offset="0" style="stop-color:darkgray;stop-opacity:1."></stop><stop offset="1" style="stop-color:gold;stop-opacity:1."></stop></linearGradient></defs><path fill="url(#c)" stroke="#00f" d="M133-64.21v-292.8h75v292.8h-75z"></path><text x="170.5" y="-340.41" font-family="Times,serif" font-size="14" text-anchor="middle">process #2</text></g><g class="node"><defs><linearGradient id="d" x1="63" x2="63" y1="-324.21" y2="-288.21" gradientUnits="userSpaceOnUse"><stop offset="0" style="stop-color:yellow;stop-opacity:1."></stop><stop offset="1" style="stop-color:green;stop-opacity:1."></stop></linearGradient></defs><ellipse cx="63" cy="-306.21" fill="url(#d)" stroke="#000" rx="27" ry="18"></ellipse><text x="63" y="-302.01" font-family="Times,serif" font-size="14" text-anchor="middle">a0</text></g><g class="node"><defs><linearGradient id="e" x1="63" x2="63" y1="-252.21" y2="-216.21" gradientUnits="userSpaceOnUse"><stop offset="0" style="stop-color:lightgreen;stop-opacity:1."></stop><stop offset="1" style="stop-color:red;stop-opacity:1."></stop></linearGradient></defs><ellipse cx="63" cy="-234.21" fill="url(#e)" stroke="#000" rx="27" ry="18"></ellipse><text x="63" y="-230.01" font-family="Times,serif" font-size="14" text-anchor="middle">a1</text></g><g class="edge"><path fill="none" stroke="#000" d="M63-287.91v24.73"></path><path stroke="#000" d="m66.5-263.32-3.5 10-3.5-10h7z"></path></g><g class="node"><defs><linearGradient id="f" x1="63" x2="63" y1="-180.21" y2="-144.21" gradientUnits="userSpaceOnUse"><stop offset="0" style="stop-color:lightskyblue;stop-opacity:1."></stop><stop offset="1" style="stop-color:darkcyan;stop-opacity:1."></stop></linearGradient></defs><ellipse cx="63" cy="-162.21" fill="url(#f)" stroke="#000" rx="27" ry="18"></ellipse><text x="63" y="-158.01" font-family="Times,serif" font-size="14" text-anchor="middle">a2</text></g><g class="edge"><path fill="none" stroke="#000" d="M63-215.91v24.73"></path><path stroke="#000" d="m66.5-191.32-3.5 10-3.5-10h7z"></path></g><g class="node"><defs><linearGradient id="g" x1="168" x2="168" y1="-108.21" y2="-72.21" gradientUnits="userSpaceOnUse"><stop offset="0" style="stop-color:mediumpurple;stop-opacity:1."></stop><stop offset="1" style="stop-color:purple;stop-opacity:1."></stop></linearGradient></defs><ellipse cx="168" cy="-90.21" fill="url(#g)" stroke="#000" rx="27" ry="18"></ellipse><text x="168" y="-86.01" font-family="Times,serif" font-size="14" text-anchor="middle">b3</text></g><g class="edge"><path fill="none" stroke="#000" d="M74.64-217.47c18.31 24.76 53.97 72.98 75.52 102.14"></path><path stroke="#000" d="m153.5-117.71 3.13 10.12-8.76-5.96 5.63-4.16z"></path></g><g class="node"><defs><linearGradient id="h" x1="63" x2="63" y1="-108.21" y2="-72.21" gradientUnits="userSpaceOnUse"><stop offset="0" style="stop-color:cyan;stop-opacity:1."></stop><stop offset="1" style="stop-color:#8470ff;stop-opacity:1."></stop></linearGradient></defs><ellipse cx="63" cy="-90.21" fill="url(#h)" stroke="#000" rx="27" ry="18"></ellipse><text x="63" y="-86.01" font-family="Times,serif" font-size="14" text-anchor="middle">a3</text></g><g class="edge"><path fill="none" stroke="#000" d="M63-143.91v24.73"></path><path stroke="#000" d="m66.5-119.32-3.5 10-3.5-10h7z"></path></g><g class="edge"><path fill="none" stroke="#000" d="M49.25-106.15c-8.21-9.96-17.87-23.82-22.25-38.06-14.11-45.88-14.11-62.12 0-108 3.22-10.47 9.28-20.72 15.53-29.37"></path><path stroke="#000" d="m40.37-283.51 8.88-5.77-3.35 10.05-5.53-4.28z"></path></g><g class="node"><defs><radialGradient id="i" cx="50%" cy="50%" r="75%" fx="50%" fy="0%"><stop offset="0" style="stop-color:lightyellow;stop-opacity:1."></stop><stop offset="1" style="stop-color:orange;stop-opacity:1."></stop></radialGradient></defs><path fill="url(#i)" stroke="#000" d="M133.11-36.21H96.89V0h36.22v-36.21z"></path><path fill="none" stroke="#000" d="m108.89-36.21-12 12M96.89-12l12 12M121.11 0l12-12M133.11-24.21l-12-12"></path><text x="115" y="-13.91" font-family="Times,serif" font-size="14" text-anchor="middle">end</text></g><g class="edge"><path fill="none" stroke="#000" d="M74.54-73.65c6.17 8.31 13.93 18.77 21 28.3"></path><path stroke="#000" d="m98.88-47.71 3.15 10.12-8.77-5.95 5.62-4.17z"></path></g><g class="node"><defs><linearGradient id="j" x1="168" x2="168" y1="-324.21" y2="-288.21" gradientUnits="userSpaceOnUse"><stop offset="0" style="stop-color:yellow;stop-opacity:1."></stop><stop offset="1" style="stop-color:magenta;stop-opacity:1."></stop></linearGradient></defs><ellipse cx="168" cy="-306.21" fill="url(#j)" stroke="#000" rx="27" ry="18"></ellipse><text x="168" y="-302.01" font-family="Times,serif" font-size="14" text-anchor="middle">b0</text></g><g class="node"><defs><linearGradient id="k" x1="170" x2="170" y1="-252.21" y2="-216.21" gradientUnits="userSpaceOnUse"><stop offset="0" style="stop-color:violet;stop-opacity:1."></stop><stop offset="1" style="stop-color:darkcyan;stop-opacity:1."></stop></linearGradient></defs><ellipse cx="170" cy="-234.21" fill="url(#k)" stroke="#000" rx="27" ry="18"></ellipse><text x="170" y="-230.01" font-family="Times,serif" font-size="14" text-anchor="middle">b1</text></g><g class="edge"><path fill="none" stroke="#000" d="M168.49-287.91c.22 7.46.47 16.37.71 24.73"></path><path stroke="#000" d="m172.72-263.41-3.21 10.09-3.78-9.89 6.99-.2z"></path></g><g class="node"><defs><linearGradient id="l" x1="173" x2="173" y1="-180.21" y2="-144.21" gradientUnits="userSpaceOnUse"><stop offset="0" style="stop-color:peachpuff;stop-opacity:1."></stop><stop offset="1" style="stop-color:red;stop-opacity:1."></stop></linearGradient></defs><ellipse cx="173" cy="-162.21" fill="url(#l)" stroke="#000" rx="27" ry="18"></ellipse><text x="173" y="-158.01" font-family="Times,serif" font-size="14" text-anchor="middle">b2</text></g><g class="edge"><path fill="none" stroke="#000" d="M170.74-215.91c.32 7.46.7 16.37 1.06 24.73"></path><path stroke="#000" d="m175.34-191.46-3.07 10.14-3.93-9.84 7-.3z"></path></g><g class="edge"><path fill="none" stroke="#000" d="M153.84-149.02c-17.35 11.04-43.13 27.45-62.8 39.96"></path><path stroke="#000" d="m93.26-105.68-10.32 2.41 6.56-8.32 3.76 5.91z"></path></g><g class="edge"><path fill="none" stroke="#000" d="M171.76-143.91c-.53 7.46-1.17 16.37-1.76 24.73"></path><path stroke="#000" d="m173.43-119.04-4.21 9.72-2.78-10.22 6.99.5z"></path></g><g class="edge"><path fill="none" stroke="#000" d="M156.24-73.65c-6.29 8.31-14.2 18.77-21.4 28.3"></path><path stroke="#000" d="m137.04-43.46-8.82 5.87 3.24-10.09 5.58 4.22z"></path></g><g class="node"><defs><radialGradient id="m" cx="50%" cy="50%" r="75%" fx="50%" fy="0%"><stop offset="0" style="stop-color:pink;stop-opacity:1."></stop><stop offset="1" style="stop-color:red;stop-opacity:1."></stop></radialGradient></defs><path fill="url(#m)" stroke="#000" d="m115-401.01-39.12 18 39.12 18 39.12-18-39.12-18z"></path><path fill="none" stroke="#000" d="M86.78-388.03V-378M104.1-370.03h21.8M143.22-378v-10.03M125.9-396h-21.8"></path><text x="115" y="-378.81" font-family="Times,serif" font-size="14" text-anchor="middle">start</text></g><g class="edge"><path fill="none" stroke="#000" d="M105.94-368.98c-7.09 10.2-17.17 24.7-25.78 37.08"></path><path stroke="#000" d="m82.52-330.16-8.58 6.21 2.83-10.2 5.75 3.99z"></path></g><g class="edge"><path fill="none" stroke="#000" d="M124.23-368.98c7.23 10.2 17.5 24.7 26.28 37.08"></path><path stroke="#000" d="m153.93-334.13 2.92 10.18-8.63-6.13 5.71-4.05z"></path></g></g></svg></p><p>In light mode this looks okay.</p></details>
<details><summary>Integration</summary><pre class="language-typescript">  <code class="language-typescript"><span class="token keyword">import</span> hpccWasm <span class="token keyword">from</span> <span class="token string">"@hpcc-js/wasm"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Code<span class="token punctuation">,</span> Node<span class="token punctuation">,</span> Parent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"mdast"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> rehypeParse <span class="token keyword">from</span> <span class="token string">"rehype-parse"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> remark <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"remark"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> optimize <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"svgo"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Plugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"unified"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> visit <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"unist-util-visit"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> plugin<span class="token operator">:</span> Plugin<span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Node<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">async</span> <span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> remarkInstance <span class="token operator">=</span> <span class="token function">remark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>rehypeParse<span class="token punctuation">,</span> <span class="token punctuation">{</span> fragment<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> space<span class="token operator">:</span> <span class="token string">"svg"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> graphvizInstance <span class="token operator">=</span> <span class="token keyword">await</span> hpccWasm<span class="token punctuation">.</span>Graphviz<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">visit</span><span class="token punctuation">(</span>
    node<span class="token punctuation">,</span>
    <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"code"</span><span class="token punctuation">,</span> lang<span class="token operator">:</span> <span class="token string">"dot"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span>node<span class="token operator">:</span> Code<span class="token punctuation">,</span> index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> parent<span class="token operator">:</span> Parent<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">optimize</span><span class="token punctuation">(</span>
        graphvizInstance<span class="token punctuation">.</span><span class="token function">layout</span><span class="token punctuation">(</span>
          node<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
          <span class="token string">"svg"</span><span class="token punctuation">,</span>
          <span class="token string">"dot"</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
      parent<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">"paragraph"</span><span class="token punctuation">,</span>
        children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"html"</span><span class="token punctuation">,</span> value <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span> hChildren<span class="token operator">:</span> remarkInstance<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span>children <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> plugin</code>
</pre><p>Thanks to <a href="https://github.com/hpcc-systems/hpcc-js-wasm">WASM port of Graphviz</a>.</p></details>
<h6 id="svgbob">svgbob</h6>
<p>Sweet stuff for dessert.</p>
<p><a href="https://github.com/ivanceras/svgbob">svgbob</a> is an ASCII graphics to SVG converter written
in Rust.</p>
<details><summary>It is just amazing.</summary><p><svg xmlns="http://www.w3.org/2000/svg" width="264" height="192"><defs><marker id="arrow" markerHeight="7" markerWidth="7" orient="auto-start-reverse" refX="4" refY="2" viewBox="-2 -2 8 8"><path d="M0 0v4l4-2-4-2z"></path></marker><marker id="diamond" markerHeight="7" markerWidth="7" orient="auto-start-reverse" refX="4" refY="2" viewBox="-2 -2 8 8"><path d="m0 2 2-2 2 2-2 2-2-2z"></path></marker><marker id="circle" markerHeight="7" markerWidth="7" orient="auto-start-reverse" refX="4" refY="4" viewBox="0 0 8 8"><circle cx="4" cy="4" r="2" class="filled"></circle></marker><marker id="open_circle" markerHeight="7" markerWidth="7" orient="auto-start-reverse" refX="4" refY="4" viewBox="0 0 8 8"><circle cx="4" cy="4" r="2" class="bg_filled"></circle></marker><marker id="big_open_circle" markerHeight="7" markerWidth="7" orient="auto-start-reverse" refX="4" refY="4" viewBox="0 0 8 8"><circle cx="4" cy="4" r="3" class="bg_filled"></circle></marker></defs><path d="M0 0h264v192H0z" class="backdrop" style="stroke:none;fill:transparent;stroke-width:2;stroke-opacity:1;fill-opacity:1;stroke-linecap:round;stroke-linejoin:miter"></path><text x="18" y="28">i</text><text x="34" y="28">love</text><text x="74" y="28">svgbob!</text><text x="138" y="76">learn</text><text x="194" y="76">stuff</text><text x="42" y="140">Alex</text><text x="146" y="156">make</text><text x="202" y="156">stuff</text><path d="M8 8a4 4 0 0 0-4 4" class="nofill"></path><path d="M4 12v24M8 8h136" class="solid"></path><path d="M144 8a4 4 0 0 1 4 4" class="nofill"></path><path d="M148 12v24" class="solid"></path><path d="M4 36a4 4 0 0 0 4 4" class="nofill"></path><path d="M8 40h52M60 40v24" class="solid"></path><path d="M80 40a8 8 0 0 0-6 4" class="nofill"></path><path d="M74 44 64 64M80 40h64" class="solid"></path><path d="M148 36a4 4 0 0 1-4 4M128 56a8 8 0 0 0-6 4" class="nofill"></path><path d="m122 60-2 4M128 56h112" class="solid"></path><path d="M240 56a8 8 0 0 1 6 4" class="nofill"></path><path d="m246 60 2 4" class="solid"></path><path d="M120 64a16 16 0 0 0 0 16M248 64a16 16 0 0 1 0 16" class="nofill"></path><path d="m120 80 2 4" class="solid"></path><path d="M122 84a8 8 0 0 0 6 4" class="nofill"></path><path d="M128 88h112M248 80l-2 4" class="solid"></path><path d="M246 84a8 8 0 0 1-6 4M56 72a4 4 0 0 0-4 4" class="nofill"></path><path d="M52 76v8M56 72h8" class="solid"></path><path d="M64 72a4 4 0 0 1 4 4" class="nofill"></path><path d="M68 76v8" class="solid"></path><path d="M52 84a4 4 0 0 0 4 4" class="nofill"></path><path d="M56 88h8M60 88l-12 24M60 88v16M60 88l12 24" class="solid"></path><path d="M68 84a4 4 0 0 1-4 4" class="nofill"></path><path d="m60 104-12 24M60 104l12 24" class="solid"></path><path d="M104 72a8 8 0 0 0-6 4" class="nofill"></path><path d="m98 76-14 28M104 72h8M68 104h16M84 104l22 44" class="solid"></path><path d="M106 148a8 8 0 0 0 6 4" class="nofill"></path><path d="M112 152h16" class="solid"></path><path d="m176 108 4-12 4 12z" class="filled"></path><path d="M180 108v20" class="solid"></path><path d="M144 136a8 8 0 0 0-6 4" class="nofill"></path><path d="m138 140-2 4M144 136h96" class="solid"></path><path d="M240 136a8 8 0 0 1 6 4" class="nofill"></path><path d="m246 140 2 4" class="solid"></path><path d="M136 144a16 16 0 0 0 0 16M248 144a16 16 0 0 1 0 16" class="nofill"></path><path d="m136 160 2 4" class="solid"></path><path d="M138 164a8 8 0 0 0 6 4" class="nofill"></path><path d="M144 168h96M248 160l-2 4" class="solid"></path><path d="M246 164a8 8 0 0 1-6 4" class="nofill"></path></svg></p><p>Is encoded with:</p><p><svg xmlns="http://www.w3.org/2000/svg" width="264" height="192"><defs><marker id="arrow" markerHeight="7" markerWidth="7" orient="auto-start-reverse" refX="4" refY="2" viewBox="-2 -2 8 8"><path d="M0 0v4l4-2-4-2z"></path></marker><marker id="diamond" markerHeight="7" markerWidth="7" orient="auto-start-reverse" refX="4" refY="2" viewBox="-2 -2 8 8"><path d="m0 2 2-2 2 2-2 2-2-2z"></path></marker><marker id="circle" markerHeight="7" markerWidth="7" orient="auto-start-reverse" refX="4" refY="4" viewBox="0 0 8 8"><circle cx="4" cy="4" r="2" class="filled"></circle></marker><marker id="open_circle" markerHeight="7" markerWidth="7" orient="auto-start-reverse" refX="4" refY="4" viewBox="0 0 8 8"><circle cx="4" cy="4" r="2" class="bg_filled"></circle></marker><marker id="big_open_circle" markerHeight="7" markerWidth="7" orient="auto-start-reverse" refX="4" refY="4" viewBox="0 0 8 8"><circle cx="4" cy="4" r="3" class="bg_filled"></circle></marker></defs><path d="M0 0h264v192H0z" class="backdrop" style="stroke:none;fill:transparent;stroke-width:2;stroke-opacity:1;fill-opacity:1;stroke-linecap:round;stroke-linejoin:miter"></path><text x="18" y="28">i</text><text x="34" y="28">love</text><text x="74" y="28">svgbob!</text><text x="138" y="76">learn</text><text x="194" y="76">stuff</text><text x="42" y="140">Alex</text><text x="146" y="156">make</text><text x="202" y="156">stuff</text><path d="M8 8a4 4 0 0 0-4 4" class="nofill"></path><path d="M4 12v24M8 8h136" class="solid"></path><path d="M144 8a4 4 0 0 1 4 4" class="nofill"></path><path d="M148 12v24" class="solid"></path><path d="M4 36a4 4 0 0 0 4 4" class="nofill"></path><path d="M8 40h52M60 40v24" class="solid"></path><path d="M80 40a8 8 0 0 0-6 4" class="nofill"></path><path d="M74 44 64 64M80 40h64" class="solid"></path><path d="M148 36a4 4 0 0 1-4 4M128 56a8 8 0 0 0-6 4" class="nofill"></path><path d="m122 60-2 4M128 56h112" class="solid"></path><path d="M240 56a8 8 0 0 1 6 4" class="nofill"></path><path d="m246 60 2 4" class="solid"></path><path d="M120 64a16 16 0 0 0 0 16M248 64a16 16 0 0 1 0 16" class="nofill"></path><path d="m120 80 2 4" class="solid"></path><path d="M122 84a8 8 0 0 0 6 4" class="nofill"></path><path d="M128 88h112M248 80l-2 4" class="solid"></path><path d="M246 84a8 8 0 0 1-6 4M56 72a4 4 0 0 0-4 4" class="nofill"></path><path d="M52 76v8M56 72h8" class="solid"></path><path d="M64 72a4 4 0 0 1 4 4" class="nofill"></path><path d="M68 76v8" class="solid"></path><path d="M52 84a4 4 0 0 0 4 4" class="nofill"></path><path d="M56 88h8M60 88l-12 24M60 88v16M60 88l12 24" class="solid"></path><path d="M68 84a4 4 0 0 1-4 4" class="nofill"></path><path d="m60 104-12 24M60 104l12 24" class="solid"></path><path d="M104 72a8 8 0 0 0-6 4" class="nofill"></path><path d="m98 76-14 28M104 72h8M68 104h16M84 104l22 44" class="solid"></path><path d="M106 148a8 8 0 0 0 6 4" class="nofill"></path><path d="M112 152h16" class="solid"></path><path d="m176 108 4-12 4 12z" class="filled"></path><path d="M180 108v20" class="solid"></path><path d="M144 136a8 8 0 0 0-6 4" class="nofill"></path><path d="m138 140-2 4M144 136h96" class="solid"></path><path d="M240 136a8 8 0 0 1 6 4" class="nofill"></path><path d="m246 140 2 4" class="solid"></path><path d="M136 144a16 16 0 0 0 0 16M248 144a16 16 0 0 1 0 16" class="nofill"></path><path d="m136 160 2 4" class="solid"></path><path d="M138 164a8 8 0 0 0 6 4" class="nofill"></path><path d="M144 168h96M248 160l-2 4" class="solid"></path><path d="M246 164a8 8 0 0 1-6 4" class="nofill"></path></svg></p><p>More examples <a href="https://ivanceras.github.io/svgbob-editor/">here</a>.</p></details>
<details><summary>The integration of svgbob is almost same easy as graphviz</summary><pre class="language-typescript">  <code class="language-typescript"><span class="token keyword">import</span> svgbob <span class="token keyword">from</span> <span class="token string">"bob-wasm"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Code<span class="token punctuation">,</span> Node<span class="token punctuation">,</span> Parent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"mdast"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> rehypeParse <span class="token keyword">from</span> <span class="token string">"rehype-parse"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> remark <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"remark"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> optimize <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"svgo"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Plugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"unified"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> visit <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"unist-util-visit"</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Options</span> <span class="token operator">=</span> <span class="token punctuation">{</span> keepStyle<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> plugin<span class="token operator">:</span> Plugin<span class="token operator">&lt;</span><span class="token punctuation">[</span>Options<span class="token punctuation">]</span><span class="token punctuation">,</span> Node<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span>options<span class="token operator">?</span><span class="token operator">:</span> Options<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">async</span> <span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> remarkInstance <span class="token operator">=</span> <span class="token function">remark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>rehypeParse<span class="token punctuation">,</span> <span class="token punctuation">{</span> fragment<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> space<span class="token operator">:</span> <span class="token string">"svg"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> svgbob<span class="token punctuation">.</span><span class="token function">loadWASM</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">visit</span><span class="token punctuation">(</span>
    node<span class="token punctuation">,</span>
    <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"code"</span><span class="token punctuation">,</span> lang<span class="token operator">:</span> <span class="token string">"bob"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span>node<span class="token operator">:</span> Code<span class="token punctuation">,</span> index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> parent<span class="token operator">:</span> Parent<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">optimize</span><span class="token punctuation">(</span>
        svgbob<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
      <span class="token keyword">const</span> hChildren <span class="token operator">=</span> remarkInstance<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span>children
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token operator">?.</span>keepStyle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hChildren<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">?.</span>type <span class="token operator">===</span> <span class="token string">"element"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          hChildren<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>hChildren<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span>
            child <span class="token operator">=></span> child<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">"element"</span> <span class="token operator">&amp;&amp;</span> child<span class="token punctuation">.</span>tagName <span class="token operator">===</span> <span class="token string">"style"</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">something's wrong</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      parent<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">"paragraph"</span><span class="token punctuation">,</span>
        children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"html"</span><span class="token punctuation">,</span> value <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span> hChildren <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> plugin</code>
</pre><p>Thanks to kind people who created <a href="https://github.com/agoose77/svgbob-wasm">svgbob WASM port</a> and <a href="https://github.com/fabiospampinato/bob-wasm/tree/master">wrapper for it</a>.</p><p>I have just removed style to fit SVG style into the website’s style.</p></details>
<h5 id="summary">Summary</h5>















































<table><thead><tr><th></th><th>mermaid</th><th>graphviz</th><th>svgbob</th></tr></thead><tbody><tr><td>usage</td><td>simple</td><td>complex</td><td>tedious</td></tr><tr><td>integration</td><td>complex</td><td>simple</td><td>simple</td></tr><tr><td>flexibility</td><td>fair</td><td>extreme</td><td>hackable</td></tr><tr><td>performance</td><td>errgh?..</td><td>fast</td><td>fast</td></tr><tr><td>designation</td><td>frontend</td><td>backend</td><td>backend</td></tr><tr><td>productivity</td><td>high</td><td>depends</td><td>low</td></tr></tbody></table>
<p>All three options can coexist providing their benefits when required.</p>
<p>However, I have not been completely satisfied by neither of them and feel an urge to
experiment with text to diagram myself. Hopefully I will find time.</p>
<h4 id="music-bandcamp">Music (Bandcamp)</h4>
<p>Cross origin policy should prevent some tracking.</p>
<details><summary>The integration</summary><pre class="language-typescript">  <code class="language-typescript"><span class="token operator">--</span><span class="token operator">-</span>
<span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  album<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  artwork<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">"none"</span> <span class="token operator">|</span> <span class="token string">"small"</span><span class="token punctuation">;</span>
  minimal<span class="token operator">?</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  size<span class="token operator">:</span> <span class="token string">"large"</span> <span class="token operator">|</span> <span class="token string">"small"</span><span class="token punctuation">;</span>
  transparent<span class="token operator">?</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  autoplay<span class="token operator">?</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> track<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token punctuation">{</span> tracklist<span class="token operator">?</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> props <span class="token operator">=</span> Astro<span class="token punctuation">.</span>props<span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">BASE_URL</span> <span class="token operator">=</span> <span class="token string">'https://bandcamp.com/EmbeddedPlayer'</span>

<span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span> album<span class="token operator">:</span> props<span class="token punctuation">.</span>album <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>artwork<span class="token punctuation">)</span> query<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"artwork"</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span>artwork<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"track"</span> <span class="token keyword">in</span> props<span class="token punctuation">)</span> query<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"track"</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span>track<span class="token punctuation">)</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>props<span class="token punctuation">.</span>tracklist<span class="token punctuation">)</span> query<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"tracklist"</span><span class="token punctuation">,</span> <span class="token string">"false"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>size<span class="token punctuation">)</span> query<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"size"</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span>size<span class="token punctuation">)</span>
query<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"transparent"</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token operator">!</span>props<span class="token punctuation">.</span>transparent<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token comment">// TODO: dynamically set colors</span>
query<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"linkcol"</span><span class="token punctuation">,</span> <span class="token string">"FFFFFF"</span><span class="token punctuation">)</span>
query<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"bgcol"</span><span class="token punctuation">,</span> <span class="token string">"333333"</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">BASE_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>query<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>

<span class="token operator">--</span><span class="token operator">-</span>

<span class="token punctuation">{</span>
  <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token string">"BANDCAMP_DISABLED"</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">"true"</span> <span class="token operator">?</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div
      style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        display<span class="token operator">:</span> <span class="token string">"flex"</span><span class="token punctuation">,</span>
        height<span class="token operator">:</span>
          props<span class="token punctuation">.</span>size <span class="token operator">===</span> <span class="token string">"large"</span> <span class="token operator">?</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>artwork <span class="token operator">?</span> <span class="token string">"120px"</span> <span class="token operator">:</span> <span class="token string">"350px"</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">"42px"</span><span class="token punctuation">,</span>
        width<span class="token operator">:</span>
          props<span class="token punctuation">.</span>size <span class="token operator">===</span> <span class="token string">"large"</span>
            <span class="token operator">?</span> props<span class="token punctuation">.</span>artwork
              <span class="token operator">?</span> <span class="token string">"300px"</span>
              <span class="token operator">:</span> <span class="token string">"350px"</span>
            <span class="token operator">:</span> <span class="token string">"100px)"</span><span class="token punctuation">,</span>
        backgroundColor<span class="token operator">:</span> <span class="token string">"var(--primary-focus)"</span><span class="token punctuation">,</span>
        justifyContent<span class="token operator">:</span> <span class="token string">"center"</span><span class="token punctuation">,</span>
        alignItems<span class="token operator">:</span> <span class="token string">"center"</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">></span>
      badncamp stub
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>iframe
      <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"bandcamp"</span>
      src<span class="token operator">=</span><span class="token punctuation">{</span>url<span class="token punctuation">}</span>
      style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        height<span class="token operator">:</span>
          props<span class="token punctuation">.</span>size <span class="token operator">===</span> <span class="token string">"large"</span> <span class="token operator">?</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>artwork <span class="token operator">?</span> <span class="token string">"120px"</span> <span class="token operator">:</span> <span class="token string">"350px"</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">"42px"</span><span class="token punctuation">,</span>
        width<span class="token operator">:</span>
          props<span class="token punctuation">.</span>size <span class="token operator">===</span> <span class="token string">"large"</span>
            <span class="token operator">?</span> props<span class="token punctuation">.</span>artwork
              <span class="token operator">?</span> <span class="token string">"max-content"</span>
              <span class="token operator">:</span> <span class="token string">"350px"</span>
            <span class="token operator">:</span> <span class="token string">"min-content"</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">/</span><span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code>
</pre><p>Killswitch is needed to keep console clear from CORS errors.</p></details>
<h3 id="navigation-preview">Navigation (Preview)</h3>
<h4 id="page-types">Page Types</h4>
<ol>
<li>Article (is a Content Item)</li>
<li>List of Content Item Previews</li>
</ol>
<h4 id="display-rules">Display Rules</h4>
<ul>
<li>Each article has an Id to match with any bound resources (e.g. Discussion)</li>
<li>If List Page contains single Item Preview, redirect to that Item instead of showing it</li>
</ul>
<h4 id="preprocessing">Preprocessing</h4>
<details><summary>Vite plugin to embed Ids and generate Previews.</summary><pre class="language-typescript">  <code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> mkdirSync<span class="token punctuation">,</span> readFileSync<span class="token punctuation">,</span> statSync<span class="token punctuation">,</span> unlinkSync<span class="token punctuation">,</span> writeFileSync <span class="token punctuation">,</span>existsSync<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> globSync <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'glob'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> dirname <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> cwd <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'process'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> remark <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"remark"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> frontmatter <span class="token keyword">from</span> <span class="token string">'remark-frontmatter'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> v4 <span class="token keyword">as</span> uuid <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'uuid'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> PluginOption <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token constant">YAML</span> <span class="token keyword">from</span> <span class="token string">'yaml'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">CONTENT_DIR</span> <span class="token operator">=</span> <span class="token string">'src/content'</span>
<span class="token keyword">const</span> <span class="token constant">INPUT_DIR</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">articles</span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">const</span> <span class="token constant">OUTPUT_DIR</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">previews</span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">const</span> <span class="token constant">REMARK_INSTANCE</span> <span class="token operator">=</span> <span class="token function">remark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>frontmatter<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> filename <span class="token keyword">of</span> <span class="token function">globSync</span><span class="token punctuation">(</span><span class="token string">"**/*"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> nodir<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> cwd<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">CONTENT_DIR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">INPUT_DIR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> inputFileStat <span class="token operator">=</span> <span class="token function">statSync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">CONTENT_DIR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">INPUT_DIR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> outputFileStat <span class="token operator">=</span> <span class="token function">statSync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">CONTENT_DIR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">OUTPUT_DIR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>inputFileStat<span class="token punctuation">.</span>ctimeMs <span class="token operator">></span> outputFileStat<span class="token punctuation">.</span>ctimeMs<span class="token punctuation">)</span>
        <span class="token function">updateEntry</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
      <span class="token function">updateEntry</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> filename <span class="token keyword">of</span> <span class="token function">globSync</span><span class="token punctuation">(</span><span class="token string">"**/*"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> nodir<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> cwd<span class="token operator">:</span> <span class="token constant">OUTPUT_DIR</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token function">statSync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">CONTENT_DIR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">INPUT_DIR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
      <span class="token function">removeEntry</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">updateEntry</span><span class="token punctuation">(</span>filename<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> articleFilename <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">CONTENT_DIR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">INPUT_DIR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token constant">REMARK_INSTANCE</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>articleFilename<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> frontmatterNode <span class="token operator">=</span> content<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>frontmatterNode <span class="token operator">||</span> frontmatterNode<span class="token punctuation">.</span>type <span class="token operator">!==</span> <span class="token string">"yaml"</span><span class="token punctuation">)</span>
    <span class="token keyword">throw</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">no front matter in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token keyword">const</span> frontmatterData <span class="token operator">=</span> <span class="token constant">YAML</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>frontmatterNode<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>frontmatterData<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">adding id for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    frontmatterData<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    frontmatterNode<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token constant">YAML</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>frontmatterData<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">writeFileSync</span><span class="token punctuation">(</span>articleFilename<span class="token punctuation">,</span> <span class="token constant">REMARK_INSTANCE</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">generating preview for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> previewFilename <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">CONTENT_DIR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">OUTPUT_DIR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">existsSync</span><span class="token punctuation">(</span><span class="token function">dirname</span><span class="token punctuation">(</span>previewFilename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">mkdirSync</span><span class="token punctuation">(</span><span class="token function">dirname</span><span class="token punctuation">(</span>previewFilename<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> content<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> child <span class="token operator">=</span> content<span class="token punctuation">.</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>child<span class="token punctuation">)</span> <span class="token keyword">continue</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">"heading"</span> <span class="token operator">&amp;&amp;</span> child<span class="token punctuation">.</span>depth <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      count<span class="token operator">++</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// cut condition</span>
        content<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">writeFileSync</span><span class="token punctuation">(</span>previewFilename<span class="token punctuation">,</span> <span class="token constant">REMARK_INSTANCE</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">removeEntry</span><span class="token punctuation">(</span>filename<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">unlinkSync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">CONTENT_DIR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">OUTPUT_DIR</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token keyword">const</span> plugin<span class="token operator">:</span> PluginOption <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"vite-plugin-project-customization"</span><span class="token punctuation">,</span>
  enforce<span class="token operator">:</span> <span class="token string">"pre"</span><span class="token punctuation">,</span>
  <span class="token function">load</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'/src/content/config.ts'</span><span class="token punctuation">)</span>
      <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> plugin<span class="token punctuation">;</span></code>
</pre><p><code>src/content/config.ts</code> appears in Vite’s <code>load</code> hook each time content changes.</p></details>
<h3 id="feedback">Feedback</h3>
<p>Discussions bound to content.</p>
<h4 id="why">Why?</h4>
<ul>
<li>
<p>Rational:</p>
<p>Feedback is important part of any system.</p>
<p>If a system is not capable of receiving a feedback it is singular, i.e. does not have
volume. Lack of volume makes it a “ghost”: removes its ability to interact with
environment.</p>
</li>
<li>
<p>Irrational:</p>
<p>I want to do it myself to have better control over the ways data handled.</p>
</li>
</ul>
<h4 id="how">How?</h4>
<ul>
<li>
<p>Use Github discussions to persist data.</p>
</li>
<li>
<p>Integrate with project:</p>
<p>User and Repository from origin URL are part of configuration</p>
</li>
</ul>
<details><summary>Some ready to use alternatives</summary><ul>
<li><a href="https://github.com/giscus/giscus/">giscus</a></li>
<li><a href="https://github.com/utterance/utterances">utterances</a></li>
<li><a href="https://github.com/gitalk/gitalk">Gitalk</a></li>
</ul></details>
<p><svg xmlns="http://www.w3.org/2000/svg" width="792" height="912"><defs><marker id="arrow" markerHeight="7" markerWidth="7" orient="auto-start-reverse" refX="4" refY="2" viewBox="-2 -2 8 8"><path d="M0 0v4l4-2-4-2z"></path></marker><marker id="diamond" markerHeight="7" markerWidth="7" orient="auto-start-reverse" refX="4" refY="2" viewBox="-2 -2 8 8"><path d="m0 2 2-2 2 2-2 2-2-2z"></path></marker><marker id="circle" markerHeight="7" markerWidth="7" orient="auto-start-reverse" refX="4" refY="4" viewBox="0 0 8 8"><circle cx="4" cy="4" r="2" class="filled"></circle></marker><marker id="open_circle" markerHeight="7" markerWidth="7" orient="auto-start-reverse" refX="4" refY="4" viewBox="0 0 8 8"><circle cx="4" cy="4" r="2" class="bg_filled"></circle></marker><marker id="big_open_circle" markerHeight="7" markerWidth="7" orient="auto-start-reverse" refX="4" refY="4" viewBox="0 0 8 8"><circle cx="4" cy="4" r="3" class="bg_filled"></circle></marker></defs><path d="M0 0h792v912H0z" class="backdrop" style="stroke:none;fill:transparent;stroke-width:2;stroke-opacity:1;fill-opacity:1;stroke-linecap:round;stroke-linejoin:miter"></path><path d="M40 40h40" class="solid"></path><text x="42" y="108">User</text><path d="M60 112v16" class="solid"></path><text x="234" y="60">Website</text><text x="434" y="60">Github</text><text x="698" y="60">Server</text><path d="M268 128v16M468 128v16M724 128v16" class="solid"></path><text x="90" y="172">access</text><text x="162" y="172">comments</text><text x="106" y="204">go</text><text x="138" y="204">to</text><text x="170" y="204">Github</text><path d="M96 216h8M112 216h8M128 216h8M144 216h8M160 216h8M176 216h8M192 216h8M208 216h8M268 256v16M24 280h8M80 280h8M96 280h8M256 280h8M272 280h8" class="solid"></path><text x="26" y="300">if</text><text x="58" y="300">Github</text><path d="M268 288v16" class="solid"></path><text x="114" y="332">do</text><text x="154" y="332">you</text><text x="202" y="332">authorize</text><text x="298" y="332">this</text><text x="354" y="332">Website?</text><text x="210" y="364">yeah</text><text x="250" y="364">,</text><text x="274" y="364">sure</text><path d="M200 376h8M216 376h8M232 376h8M248 376h8M264 376h8M280 376h8M296 376h8M268 384v16M264 408h8M312 408h8M328 408h8M344 408h8M376 408h8M392 408h8M408 408h8" class="solid"></path><text x="322" y="428">Auth</text><text x="378" y="428">Code</text><path d="M304 440h8M320 440h8M336 440h8M352 440h8M368 440h8M384 440h8M400 440h8M416 440h8M432 440h8" class="solid"></path><text x="290" y="460">issue</text><text x="354" y="460">me</text><text x="394" y="460">a</text><text x="426" y="460">token,</text><text x="498" y="460">I</text><text x="530" y="460">have</text><text x="586" y="460">Auth</text><text x="642" y="460">Code</text><text x="506" y="492">Auth</text><text x="562" y="492">Code</text><text x="618" y="492">+</text><text x="650" y="492">Secret</text><text x="506" y="524">Auth</text><text x="562" y="524">Token</text><path d="M496 536h8M512 536h8M528 536h8M560 536h8M576 536h8M592 536h8" class="solid"></path><text x="706" y="540">&gt;</text><path d="M464 568h8M468 576v16" class="solid"></path><text x="346" y="652">Auth</text><text x="402" y="652">Token</text><path d="M468 640v16M468 672v16" class="solid"></path><text x="82" y="700">show</text><text x="138" y="700">me</text><text x="178" y="700">data</text><text x="298" y="716">get</text><text x="330" y="716">me</text><text x="354" y="716">data</text><path d="M468 704v16" class="solid"></path><text x="498" y="748">request</text><text x="578" y="748">+</text><text x="602" y="748">Auth</text><text x="650" y="748">Token</text><text x="498" y="780">response</text><text x="578" y="780">with</text><text x="626" y="780">data</text><path d="M496 792h8M512 792h8M528 792h8M544 792h8M560 792h8M576 792h8M592 792h8M608 792h8M624 792h8M640 792h8M656 792h8" class="solid"></path><text x="706" y="796">&gt;</text><text x="74" y="844">&lt;</text><path d="M468 160v16M724 160v16M724 192v16M224 216h8M240 216h8M468 208v16M724 224v16M724 256v16M12 280v24M112 280h8M128 280h8M144 280h8M160 280h8M176 280h8" class="solid"></path><text x="122" y="300">session</text><path d="M192 280h8M208 280h8M224 280h8M240 280h8" class="solid"></path><text x="194" y="300">expired</text><path d="M288 280h8M304 280h8M320 280h8M336 280h8M352 280h8M368 280h8M384 280h8M400 280h8M416 280h8M432 280h8M724 288v16M12 320v16M508 320v16M724 320v16M12 352v16M508 352v16M724 352v16M88 376h8M104 376h8M120 376h8M136 376h8M152 376h8M168 376h8M184 376h8M312 376h8M328 376h8M344 376h8M360 376h8M376 376h8M392 376h8M408 376h8M424 376h8M12 384v24M508 384v24M724 384v16M24 408h8M88 408h8M104 408h8M120 408h8M136 408h8M152 408h8M168 408h8M184 408h8M200 408h8M216 408h8M232 408h8M248 408h8M280 408h8M296 408h8M360 408h8M424 408h8M440 408h8M488 408h8M724 416v16M544 536h8M608 536h8M624 536h8M640 536h8M656 536h8M672 536h8M688 536h8" class="solid"></path><text x="346" y="556">Auth</text><path d="M336 568h8M352 568h8M368 568h8" class="solid"></path><text x="402" y="556">Token</text><path d="M400 568h8M416 568h8M432 568h8M304 568h8M320 568h8M384 568h8M448 568h8M480 568h8M496 568h8M512 568h8M528 568h8M544 568h8M560 568h8M576 568h8M592 568h8M608 568h8M624 568h8M640 568h8M656 568h8M672 568h8M688 568h8M468 608v16" class="solid"></path><text x="690" y="668">GraphQL</text><path d="M672 792h8M688 792h8" class="solid"></path><text x="322" y="812">data</text><path d="M320 824h8M336 824h8M352 824h8" class="solid"></path><text x="90" y="828">data</text><path d="M88 840h8M104 840h8M120 840h8" class="solid"></path><text x="146" y="828">view</text><path d="M136 840h8M152 840h8M168 840h8M304 824h8M368 824h8M384 824h8M400 824h8M416 824h8M432 824h8M448 824h8M464 824h8M480 824h8M496 824h8M512 824h8M528 824h8M544 824h8M560 824h8M576 824h8M592 824h8M608 824h8M624 824h8M640 824h8M656 824h8M672 824h8M688 824h8M184 840h8M200 840h8M216 840h8M232 840h8M724 864v16M268 880v16" class="solid"></path><path d="M56 8a4 4 0 0 0-4 4" class="nofill"></path><path d="M52 12v8M56 8h8" class="solid"></path><path d="M64 8a4 4 0 0 1 4 4" class="nofill"></path><path d="M68 12v8" class="solid"></path><path d="M52 20a4 4 0 0 0 4 4" class="nofill"></path><path d="M56 24h8M60 24v32" class="solid"></path><path d="M68 20a4 4 0 0 1-4 4" class="nofill"></path><path d="M60 56 40 96M60 56l20 40M220 24h96M220 24v64M316 24v64M220 88h96M268 88v24M404 24h120M404 24v64M524 24v64M404 88h120M468 88v24M668 24h112M668 24v64M780 24v64M668 88h112M724 88v24M60 144v24M52 168h16M52 168v120M68 168v120M68 184h180" class="solid"></path><path d="m248 180 8 4-8 4z" class="filled"></path><path d="M68 248h380" class="solid"></path><path d="m448 244 8 4-8 4z" class="filled"></path><path d="M40 280h12M268 160v24M260 184h16M260 184v32M276 184v32M260 216h16M268 216v24" class="solid"></path><path d="m80 212-8 4 8 4z" class="filled"></path><path d="M80 216h8M460 248h16M460 248v80M476 248v192M448 280h12M476 280h12M452 328h16M452 328v48M468 328v48M452 376h16M460 376v64M448 440h28" class="solid"></path><path d="m80 340-8 4 8 4z" class="filled"></path><path d="M80 344h372M52 304v568M40 408h12M68 304v568M68 376h12M68 408h12M68 712h180" class="solid"></path><path d="m248 708 8 4-8 4z" class="filled"></path><path d="M52 872h16M60 872v24M440 372l8 4M448 376l-8 4M268 416v24M260 440h16M260 440v224M276 440v224M276 472h428" class="solid"></path><path d="m704 468 8 4-8 4z" class="filled"></path><path d="M260 664h396M268 664v48" class="solid"></path><path d="m656 660 8 4-8 4z" class="filled"></path><path d="M260 712h16M260 712v128M276 712v128M276 728h428" class="solid"></path><path d="m704 724 8 4-8 4z" class="filled"></path><path d="M248 840h28M268 840v24" class="solid"></path><path d="m288 436-8 4 8 4z" class="filled"></path><path d="M288 440h8M724 448v24M716 472h16M716 472v96M732 472v96M704 568h28M724 568v24" class="solid"></path><path d="m488 500-8 4 8 4z" class="filled"></path><path d="M488 504h228M468 480v24M460 504h16M460 504v32M476 504v32M460 536h28M468 536v24" class="solid"></path><path d="m288 564-8 4 8 4z" class="filled"></path><path d="M288 568h8M668 632h104M668 632v64M772 632v64M668 696h104M724 696v32M716 728h16M716 728v96M732 728v96M704 824h28M724 824v24" class="solid"></path><path d="m488 756-8 4 8 4z" class="filled"></path><path d="M488 760h228M468 736v24M460 760h16M460 760v32M476 760v32M460 792h28" class="solid"></path><path d="m288 820-8 4 8 4z" class="filled"></path><path d="M288 824h8M496 280h12M508 280v24" class="solid"></path></svg></p>
<h4 id="authentication">Authentication</h4>
<p>Microservice for <a href="https://datatracker.ietf.org/doc/html/rfc6749#section-4.1">OAuth Code Grant</a> flow</p>
<details><summary>Alternative</summary><p><a href="https://docs.github.com/en/apps">Github Apps</a>:</p><ul>
<li>requires a bit more complicated backend</li>
<li>allows fine-grained permissions settings =&gt; more secure</li>
<li>non-standard (comparing to standardized OAuth2 framework)</li>
</ul></details>
<details><summary>Client-side Authentication</summary><p>Discussions are <code>client:only</code>.</p><p>Github-harness is provided as &lt;Github/&gt; component. It follows semantics of
<a href="https://www.solidjs.com/docs/latest/api#show">Solid’s &lt;Show/&gt;</a>:</p><pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Github</span></span>
  <span class="token attr-name">fallback</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">LoginButton</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
    <span class="token comment">/* render login UI here */</span>
  <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
  <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>clientConfiguration<span class="token punctuation">}</span></span>
<span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">client<span class="token punctuation">,</span> LogoutButton</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
    <span class="token comment">/* use client to fetch data for UI */</span>
  <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Github</span></span><span class="token punctuation">&gt;</span></span></code></pre><ul>
<li>Access Token is only in memory of that component.</li>
<li>If page is refreshed, token is gone.</li>
</ul><pre class="language-tsx">  <code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">JSX</span><span class="token punctuation">,</span> JSXElement<span class="token punctuation">,</span> Show<span class="token punctuation">,</span> createEffect<span class="token punctuation">,</span> createSignal<span class="token punctuation">,</span> createUniqueId<span class="token punctuation">,</span> mergeProps<span class="token punctuation">,</span> splitProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'solid-js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> GithubClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'~/integrations/github'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> createGithubClient <span class="token keyword">from</span> <span class="token string">'~/integrations/github'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">BASE_URL</span> <span class="token operator">=</span> <span class="token string">"https://github.com/login/oauth/authorize"</span>

<span class="token keyword">const</span> <span class="token punctuation">[</span>getToken<span class="token punctuation">,</span> setToken<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createSignal</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  location<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
  clientId<span class="token operator">:</span> <span class="token builtin">string</span>
  authURL<span class="token operator">:</span> <span class="token builtin">string</span>
  user<span class="token operator">:</span> <span class="token builtin">string</span>
  repo<span class="token operator">:</span> <span class="token builtin">string</span>

  <span class="token function-variable function">fallback</span><span class="token operator">:</span> <span class="token punctuation">(</span>
    <span class="token function-variable function">LoginButton</span><span class="token operator">:</span> <span class="token punctuation">(</span>props<span class="token operator">:</span> <span class="token constant">JSX</span><span class="token punctuation">.</span>HTMLAttributes<span class="token operator">&lt;</span>HTMLButtonElement<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=></span> JSXElement
  <span class="token punctuation">)</span> <span class="token operator">=></span> JSXElement

  <span class="token function-variable function">children</span><span class="token operator">:</span> <span class="token punctuation">(</span>
    github<span class="token operator">:</span> GithubClient<span class="token punctuation">,</span>
    <span class="token function-variable function">LogoutButton</span><span class="token operator">:</span> <span class="token punctuation">(</span>props<span class="token operator">:</span> <span class="token constant">JSX</span><span class="token punctuation">.</span>HTMLAttributes<span class="token operator">&lt;</span>HTMLButtonElement<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=></span> JSXElement
  <span class="token punctuation">)</span> <span class="token operator">=></span> JSXElement
<span class="token punctuation">}</span> <span class="token operator">&amp;</span> Omit<span class="token operator">&lt;</span><span class="token constant">JSX</span><span class="token punctuation">.</span>HTMLAttributes<span class="token operator">&lt;</span>HTMLButtonElement<span class="token operator">></span><span class="token punctuation">,</span> <span class="token string">"children"</span><span class="token operator">></span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span>props<span class="token operator">:</span> Props<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">createUniqueId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// ! entanglement</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isBusy<span class="token punctuation">,</span> setBusy<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">createSignal</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>localProps<span class="token punctuation">,</span> remote<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">splitProps</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"fallback"</span><span class="token punctuation">,</span> <span class="token string">"location"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>authProps<span class="token punctuation">,</span> other<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">splitProps</span><span class="token punctuation">(</span>remote<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"clientId"</span><span class="token punctuation">,</span> <span class="token string">"authURL"</span><span class="token punctuation">,</span> <span class="token string">"children"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>clientProps<span class="token punctuation">,</span> globalButtonProps<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">splitProps</span><span class="token punctuation">(</span>other<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"repo"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> code <span class="token operator">=</span> url<span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      url<span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span>
      history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> url<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      location<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token string">"#"</span> <span class="token operator">+</span> id<span class="token punctuation">)</span>
      <span class="token keyword">const</span> authURL <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>authProps<span class="token punctuation">.</span>authURL<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span> code <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
      <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>authURL<span class="token punctuation">)</span>
      <span class="token keyword">const</span> responseParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> access_token <span class="token operator">=</span> responseParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"access_token"</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> token_type <span class="token operator">=</span> responseParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"token_type"</span><span class="token punctuation">)</span>
      <span class="token function">setToken</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>token_type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>access_token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token function">setBusy</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">login</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      client_id<span class="token operator">:</span> authProps<span class="token punctuation">.</span>clientId<span class="token punctuation">,</span>
      redirect_uri<span class="token operator">:</span> <span class="token function">getRedirectUri</span><span class="token punctuation">(</span>localProps<span class="token punctuation">.</span>location<span class="token punctuation">)</span><span class="token punctuation">,</span>
      scope<span class="token operator">:</span> <span class="token string">"public_repo"</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">BASE_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>query<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token function-variable function">logout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>


  <span class="token keyword">const</span> <span class="token function-variable function">Button</span> <span class="token operator">=</span> <span class="token punctuation">(</span>localButtonProps<span class="token operator">:</span> <span class="token constant">JSX</span><span class="token punctuation">.</span>HTMLAttributes<span class="token operator">&lt;</span>HTMLButtonElement<span class="token operator">></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
      <span class="token attr-name">id</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span></span>
      <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>login<span class="token punctuation">}</span></span>
      <span class="token attr-name">aria-busy</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">isBusy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">"true"</span> <span class="token operator">:</span> <span class="token string">"false"</span><span class="token punctuation">}</span></span>
      <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>globalButtonProps<span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>localButtonProps<span class="token punctuation">}</span></span>
      <span class="token attr-name">disabled</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">isBusy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
    <span class="token punctuation">/></span></span>
  <span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Show</span></span> <span class="token attr-name">when</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
      <span class="token attr-name">fallback</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>localProps<span class="token punctuation">.</span><span class="token function">fallback</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span>localButtonProps<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>login<span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>globalButtonProps<span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>localButtonProps<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
    <span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>
        authProps<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
          <span class="token comment">// github client</span>
          <span class="token function">createGithubClient</span><span class="token punctuation">(</span><span class="token function">mergeProps</span><span class="token punctuation">(</span>clientProps<span class="token punctuation">,</span> <span class="token punctuation">{</span> auth<span class="token operator">:</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token comment">// logout button</span>
          <span class="token punctuation">(</span>localButtonProps<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>logout<span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>globalButtonProps<span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>localButtonProps<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Show</span></span> <span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// utils</span>

<span class="token keyword">function</span> <span class="token function">getRedirectUri</span><span class="token punctuation">(</span>location<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>location<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    url<span class="token punctuation">.</span>pathname <span class="token operator">=</span> location
  <span class="token punctuation">}</span>
  url<span class="token punctuation">.</span>hash <span class="token operator">=</span> <span class="token string">""</span>
  <span class="token keyword">return</span> url<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code>
</pre></details>
<details><summary>Server-side Authentication</summary><ol>
<li>
<p>Cloud function is <a href="https://cloud.google.com/functions/pricing">cost efficient for such tasks</a>:</p>
<p>Considering amount of expected visitors equal to zero, it should be free.</p>
</li>
<li>
<p>GCP Secret Manager is used to store Client Secret</p>
<ul>
<li>
<p>Delegation is a profitable strategy when applied wisely☝</p>
</li>
<li>
<p>Storing small amount of secrets <a href="https://cloud.google.com/secret-manager/pricing">is also almost free in GCP</a></p>
</li>
</ul>
</li>
</ol><p>Prerequisites:</p><ul>
<li>
<p><a href="https://github.com/settings/developers">Create OAuth application on Github</a></p>
<ul>
<li>
<p>Set <code>github_client_secret</code> in GCP Secret Manager</p>
<p>Secret Manager should contain <code>github_client_secret</code> with <code>latest</code> version value
corresponding to the actual Client Secret provided by Github</p>
</li>
<li>
<p>Set <code>GITHUB_OAUTH_CLIENT_ID</code> environment variable</p>
</li>
</ul>
</li>
<li>
<p>Service Account (by default - App Engine’s default SA) which executes cloud
function MUST have role “Secret Manager Secret Accessor”</p>
<blockquote>
<p><strong>NOTE:</strong> It should be possible to setup fine-grained rules for each role, but for me
it did not work for a specific secret name</p>
</blockquote>
</li>
<li>
<p>Set <code>BASE_URL</code> environment variable</p>
<blockquote>
<p><strong>ATTENTION:</strong> One may fail a part, but ought to chamfer it.
Same with security: don’t neglect CORS, set exact URLs in policy headers.</p>
</blockquote>
</li>
</ul><pre class="language-go">  <code class="language-go"><span class="token keyword">package</span> p

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"io"</span>
	<span class="token string">"net/http"</span>
	<span class="token string">"net/url"</span>
	<span class="token string">"os"</span>
	<span class="token string">"strings"</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> BASE_URL <span class="token operator">=</span> <span class="token string">"https://github.com/login/oauth/access_token"</span>

<span class="token comment">// minimal github oauth2 flow integration function</span>
<span class="token keyword">func</span> <span class="token function">Authenticate</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment">// read configuration</span>

	client_secret<span class="token punctuation">,</span> set <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">LookupEnv</span><span class="token punctuation">(</span><span class="token string">"CLIENT_SECRET"</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>set <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"env: CLIENT_SECRET not set"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	client_id<span class="token punctuation">,</span> set <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">LookupEnv</span><span class="token punctuation">(</span><span class="token string">"CLIENT_ID"</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>set <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"env: CLIENT_ID not set"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	cors_origin<span class="token punctuation">,</span> set <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">LookupEnv</span><span class="token punctuation">(</span><span class="token string">"CORS_ORIGIN"</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>set <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"env: CORS_ORIGIN not set"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// read input</span>

	code<span class="token punctuation">,</span> set <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"code"</span><span class="token punctuation">]</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>set <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"input: code is not provided"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// execute request</span>
	urlParams <span class="token operator">:=</span> url<span class="token punctuation">.</span>Values<span class="token punctuation">{</span>
		<span class="token string">"client_id"</span><span class="token punctuation">:</span>     <span class="token punctuation">{</span>client_id<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">"client_secret"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>client_secret<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string">"code"</span><span class="token punctuation">:</span>          code<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span>BASE_URL<span class="token punctuation">,</span> <span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>urlParams<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// parse response</span>
	token<span class="token punctuation">,</span> err <span class="token operator">:=</span> io<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// respond with token</span>
	w<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin"</span><span class="token punctuation">,</span> cors_origin<span class="token punctuation">)</span>
	w<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Methods"</span><span class="token punctuation">,</span> <span class="token string">"GET"</span><span class="token punctuation">)</span>
	w<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Cache-Control"</span><span class="token punctuation">,</span> <span class="token string">"no-cache"</span><span class="token punctuation">)</span>
	w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code>
</pre><p>Why go? - It’s the fastest available.</p><p>Deployment script:</p><pre class="language-sh">  <code class="language-sh"><span class="token shebang important">#!/bin/sh</span>

<span class="token builtin class-name">.</span> <span class="token punctuation">..</span>/.env

gcloud functions deploy oauth2 <span class="token punctuation">\</span>
  <span class="token parameter variable">--runtime</span> go120 <span class="token punctuation">\</span>
  --trigger-http <span class="token punctuation">\</span>
  <span class="token parameter variable">--source</span> <span class="token builtin class-name">.</span> <span class="token punctuation">\</span>
  --entry-point Authenticate <span class="token punctuation">\</span>
  <span class="token parameter variable">--region</span> us-central1 <span class="token punctuation">\</span>
  --set-env-vars <span class="token assign-left variable">CLIENT_ID</span><span class="token operator">=</span><span class="token variable">${GITHUB_OAUTH_CLIENT_ID}</span>,CORS_ORIGIN<span class="token operator">=</span><span class="token variable">${BASE_URL}</span> <span class="token punctuation">\</span>
  --set-secrets <span class="token assign-left variable">CLIENT_SECRET</span><span class="token operator">=</span>github_client_secret:latest <span class="token punctuation">\</span>
  --docker-registry container-registry <span class="token punctuation">\</span>
  <span class="token parameter variable">--memory</span> 128MB</code>
</pre></details>
<h4 id="github-graphql-client">Github GraphQL Client</h4>
<p>Inception: <a href="https://docs.github.com/en/graphql/overview/explorer">Github’s GraphQL Explorer</a>.</p>
<h5 id="tools-1">Tools</h5>
<ul>
<li>
<p><a href="https://the-guild.dev/graphql/codegen">@graphql-codegen/cli</a> to bind schema to code</p>
</li>
<li>
<p><a href="https://formidable.com/open-source/urql/">URQL</a> to execute requests</p>
</li>
</ul>
<details><summary>Alternatives</summary><ul>
<li>
<p><a href="https://github.com/octokit/graphql.js/">@octokit/graphql</a></p>
<p>does not bring any benefits comparing to standard <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch API</a></p>
</li>
<li>
<p><a href="https://www.apollographql.com/">Apollo</a></p>
<p>for shooting sparrows from a cannon</p>
</li>
<li>
<p><a href="https://github.com/graphql-editor/graphql-zeus">graphql-zeus</a></p>
<p>neat, but brings in vulnerabilities</p>
</li>
</ul></details>
<details><summary>Schema caching</summary><pre class="language-sh">  <code class="language-sh"><span class="token shebang important">#!/bin/sh</span>

<span class="token builtin class-name">set</span> <span class="token parameter variable">-e</span>

<span class="token builtin class-name">.</span> ./.env

<span class="token assign-left variable">SCHEMA_FILE</span><span class="token operator">=</span><span class="token string">"src/integrations/github/graphql/schema.json"</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token variable">$SCHEMA_FILE</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">exit</span> <span class="token number">0</span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$SECRET_GITHUB_TOKEN</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"env: SECRET_GITHUB_TOKEN not set"</span> <span class="token operator"><span class="token file-descriptor important">1</span>></span><span class="token file-descriptor important">&amp;2</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token function">curl</span> https://api.github.com/graphql <span class="token punctuation">\</span>
  <span class="token parameter variable">-H</span> <span class="token string">"Authorization: token <span class="token variable">$SECRET_GITHUB_TOKEN</span>"</span> <span class="token punctuation">\</span>
<span class="token operator">></span> <span class="token variable">$SCHEMA_FILE</span>
</code>
</pre></details>
<h5 id="client-operations">Client operations</h5>
<p>In order to satisfy basic commenting use case, I have created few GraphQL files.</p>
<details><p><summary>Add Discussion Comment</summary>
Invoked when user clicks “comment” button.</p><pre class="language-graphql">  <code class="language-graphql"><span class="token keyword">mutation</span> <span class="token definition-mutation function">AddDiscussionComment</span><span class="token punctuation">(</span><span class="token variable variable-input">$discussionId</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">,</span> <span class="token variable variable-input">$body</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token property-query property-mutation">addDiscussionComment</span><span class="token punctuation">(</span><span class="token attr-name">input</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token attr-name">discussionId</span><span class="token punctuation">:</span> <span class="token variable variable-input">$discussionId</span><span class="token punctuation">,</span> <span class="token attr-name">body</span><span class="token punctuation">:</span> <span class="token variable variable-input">$body</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token object">comment</span> <span class="token punctuation">{</span>
      <span class="token property">id</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code>
</pre></details>
<details><p><summary>Create Discussion</summary>
Invoked during static website generation to create discussion for newly published
content.</p><pre class="language-graphql">  <code class="language-graphql"><span class="token keyword">mutation</span> <span class="token definition-mutation function">CreateDiscussion</span><span class="token punctuation">(</span>
  <span class="token variable variable-input variable-input">$repositoryId</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span>
  <span class="token variable variable-input variable-input">$categoryId</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span>
  <span class="token variable variable-input variable-input">$title</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token property-query property-mutation property-mutation">createDiscussion</span><span class="token punctuation">(</span>
    <span class="token attr-name">input</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token attr-name">repositoryId</span><span class="token punctuation">:</span> <span class="token variable variable-input variable-input">$repositoryId</span>
      <span class="token attr-name">title</span><span class="token punctuation">:</span> <span class="token variable variable-input variable-input">$title</span>
      <span class="token attr-name">body</span><span class="token punctuation">:</span> <span class="token description string">"<span class="token language-markdown">blank</span>"</span>
      <span class="token attr-name">categoryId</span><span class="token punctuation">:</span> <span class="token variable variable-input variable-input">$categoryId</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token object">discussion</span> <span class="token punctuation">{</span>
      <span class="token property">id</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code>
</pre></details>
<details><p><summary>Get Discussion Comments</summary>
Invoked when user is authorized to work with Github client.</p><pre class="language-graphql">  <code class="language-graphql"><span class="token keyword">query</span> <span class="token definition-query function">GetDiscussionComments</span><span class="token punctuation">(</span>
  <span class="token variable">$discussionId</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span>
  <span class="token variable">$batchSize</span><span class="token punctuation">:</span> <span class="token scalar">Int</span><span class="token operator">!</span>
  <span class="token variable">$iterator</span><span class="token punctuation">:</span> <span class="token scalar">String</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token property-query">node</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token variable">$discussionId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property">__typename</span>
    <span class="token operator">...</span> <span class="token keyword">on</span> <span class="token class-name">Discussion</span> <span class="token punctuation">{</span>
      <span class="token property-query">comments</span><span class="token punctuation">(</span><span class="token attr-name">first</span><span class="token punctuation">:</span> <span class="token variable">$batchSize</span><span class="token punctuation">,</span> <span class="token attr-name">after</span><span class="token punctuation">:</span> <span class="token variable">$iterator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token object">edges</span> <span class="token punctuation">{</span>
          <span class="token object">node</span> <span class="token punctuation">{</span>
            <span class="token property">id</span>
            <span class="token property">body</span>
            <span class="token object">author</span> <span class="token punctuation">{</span>
              <span class="token property">login</span>
              <span class="token operator">...</span> <span class="token keyword">on</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
                <span class="token property">name</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token object">pageInfo</span> <span class="token punctuation">{</span>
          <span class="token property">endCursor</span>
          <span class="token property">hasNextPage</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code>
</pre></details>
<details><p><summary>Get Discussions</summary>
Invoked during static website generation to provide all discussions that are already
there.</p><pre class="language-graphql">  <code class="language-graphql"><span class="token keyword">query</span> <span class="token definition-query function">GetDiscussions</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">,</span> <span class="token variable">$repo</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">,</span> <span class="token variable">$iterator</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token property-query">repository</span><span class="token punctuation">(</span><span class="token attr-name">owner</span><span class="token punctuation">:</span> <span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token attr-name">name</span><span class="token punctuation">:</span> <span class="token variable">$repo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property-query">discussions</span><span class="token punctuation">(</span><span class="token attr-name">first</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token attr-name">after</span><span class="token punctuation">:</span> <span class="token variable">$iterator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token object">edges</span> <span class="token punctuation">{</span>
        <span class="token object">node</span> <span class="token punctuation">{</span>
          <span class="token property">id</span>
          <span class="token property">title</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token object">pageInfo</span> <span class="token punctuation">{</span>
        <span class="token property">hasNextPage</span>
        <span class="token property">endCursor</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code>
</pre></details>
<details><p><summary>Get Ids Of Repository And Discussion Category</summary>
Invoked during static website generation to provide all discussions that are already
there.</p><pre class="language-graphql">  <code class="language-graphql"><span class="token keyword">query</span> <span class="token definition-query function">GetIdsOfRepositoryAndDiscussionCategory</span><span class="token punctuation">(</span>
  <span class="token variable">$user</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span>
  <span class="token variable">$repo</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token property-query">repository</span><span class="token punctuation">(</span><span class="token attr-name">owner</span><span class="token punctuation">:</span> <span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token attr-name">name</span><span class="token punctuation">:</span> <span class="token variable">$repo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token comment"># TODO: parameterize</span>
    <span class="token property-query">discussionCategories</span><span class="token punctuation">(</span><span class="token attr-name">first</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token object">nodes</span> <span class="token punctuation">{</span>
        <span class="token property">id</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code>
</pre></details>
<p>All generated code is ignored by git.</p>
<h6 id="todo">TODO</h6>
<ul>
<li>
<p>Live comments: use GraphQL subscriptions</p>
</li>
<li>
<p>Transparent Title:</p>
<ul>
<li>
<p>Human-Readable titles in Github discussions</p>
</li>
<li>
<p>Heuristics to match Content with Discussion</p>
</li>
<li>
<p>Transformers to update existing data</p>
</li>
</ul>
</li>
<li>
<p>Support Replies</p>
</li>
</ul>
<h3 id="fanciness">Fanciness</h3>
<ul>
<li>
<p><a href="https://picocss.com/">PicoCSS framework</a> brings style to semantic markup.</p>
</li>
<li>
<p>Minimal customizations for c9e</p>
</li>
<li>
<p>PicoCSS may be fully replaced or adapted later; semantic markup will stay</p>
</li>
</ul>
<h4 id="color-scheme-preference">Color Scheme Preference</h4>
<ul>
<li>
<p><code>default</code> is determined with media-query feature
<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-color-scheme">prefers-color-scheme</a></p>
</li>
<li>
<p><a href="https://picocss.com/">PicoCSS framework</a> handles it out of the box</p>
</li>
<li>
<p>Source code embeddings require separate implementation of color scheme preference</p>
<p>Astro Default - <a href="https://github.com/shikijs/shiki">Shiki</a> does not allow to handle runtime
color change.</p>
<p>Alternative - <a href="https://prismjs.com/">Prism</a> is less functional, but easier to support
color scheme preference</p>
<details><summary>Implementation Code</summary><pre class="language-html">  <code class="language-html">---
import { readFileSync } from "fs";
import Prism from "prismjs";
import loadLanguages from "prismjs/components/";

type Props = {
  file: string;
  lang: string;
};

const { file, lang } = Astro.props;

loadLanguages([Astro.props.lang]);
const grammar = Prism.languages[lang];
if (!grammar) throw `no grammar for language ${lang}`;
const code = readFileSync(file).toString();
const highlightedCode = Prism.highlight(code, grammar, lang);
---

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span>
  <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{`language-${lang}`}</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{`language-${lang}`}</span> <span class="token attr-name"><span class="token namespace">set:</span>html</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{highlightedCode}</span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> codeLightCSS <span class="token keyword">from</span> <span class="token string">"prismjs/themes/prism-solarizedlight.css?inline"</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> codeDarkCSS <span class="token keyword">from</span> <span class="token string">"prismjs/themes/prism-tomorrow.css?inline"</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> darkStyleElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"style"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  darkStyleElement<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> codeDarkCSS<span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>darkStyleElement<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> lightStyleElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"style"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  lightStyleElement<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> codeLightCSS<span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>lightStyleElement<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> matcher <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">matchMedia</span><span class="token punctuation">(</span><span class="token string">"(prefers-color-scheme: dark)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>matcher<span class="token punctuation">.</span>matches<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      darkStyleElement<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      lightStyleElement<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      darkStyleElement<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      lightStyleElement<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  matcher<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"change"</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code>
</pre></details>
</li>
</ul>
<details><summary>TODO</summary><ul>
<li>Manual override with a button/toggle:</li>
</ul><p><svg xmlns="http://www.w3.org/2000/svg" width="312" height="256"><defs><marker id="arrow" markerHeight="7" markerWidth="7" orient="auto-start-reverse" refX="4" refY="2" viewBox="-2 -2 8 8"><path d="M0 0v4l4-2-4-2z"></path></marker><marker id="diamond" markerHeight="7" markerWidth="7" orient="auto-start-reverse" refX="4" refY="2" viewBox="-2 -2 8 8"><path d="m0 2 2-2 2 2-2 2-2-2z"></path></marker><marker id="circle" markerHeight="7" markerWidth="7" orient="auto-start-reverse" refX="4" refY="4" viewBox="0 0 8 8"><circle cx="4" cy="4" r="2" class="filled"></circle></marker><marker id="open_circle" markerHeight="7" markerWidth="7" orient="auto-start-reverse" refX="4" refY="4" viewBox="0 0 8 8"><circle cx="4" cy="4" r="2" class="bg_filled"></circle></marker><marker id="big_open_circle" markerHeight="7" markerWidth="7" orient="auto-start-reverse" refX="4" refY="4" viewBox="0 0 8 8"><circle cx="4" cy="4" r="3" class="bg_filled"></circle></marker></defs><path d="M0 0h312v256H0z" class="backdrop" style="stroke:none;fill:transparent;stroke-width:2;stroke-opacity:1;fill-opacity:1;stroke-linecap:round;stroke-linejoin:miter"></path><text x="178" y="108">default</text><path d="M152 216h8" class="solid"></path><text x="178" y="220">override</text><text x="226" y="60">load</text><text x="50" y="140">persisted</text><text x="154" y="172">toggle</text><text x="242" y="172">toggle</text><path d="M104 216h8M120 216h8M136 216h8" class="solid"></path><path d="M208 8a4 4 0 0 0-4 4" class="nofill"></path><path d="M204 12v8M208 8h8" class="solid"></path><path d="M216 8a4 4 0 0 1 4 4" class="nofill"></path><path d="M220 12v8" class="solid"></path><path d="M204 20a4 4 0 0 0 4 4" class="nofill"></path><path d="M208 24h8M212 24v44" class="solid"></path><path d="M220 20a4 4 0 0 1-4 4" class="nofill"></path><path d="M208 68h8l-4 12z" class="filled"></path><path d="M176 88a8 8 0 0 0-6 4" class="nofill"></path><path d="m170 92-2 4M176 88h72" class="solid"></path><path d="M248 88a8 8 0 0 1 6 4" class="nofill"></path><path d="m254 92 2 4" class="solid"></path><path d="M168 96a16 16 0 0 0 0 16M256 96a16 16 0 0 1 0 16" class="nofill"></path><path d="m168 112 2 4" class="solid"></path><path d="M170 116a8 8 0 0 0 6 4" class="nofill"></path><path d="M176 120h72M256 112l-2 4" class="solid"></path><path d="M254 116a8 8 0 0 1-6 4" class="nofill"></path><path d="m272 100-8 4 8 4z" class="filled"></path><path d="M272 104h24" class="solid"></path><path d="M296 104a4 4 0 0 1 4 4" class="nofill"></path><path d="M300 108v104M264 216h32" class="solid"></path><path d="M300 212a4 4 0 0 1-4 4" class="nofill"></path><path d="M212 128v52" class="solid"></path><path d="M208 180h8l-4 12z" class="filled"></path><path d="M176 200a8 8 0 0 0-6 4" class="nofill"></path><path d="m170 204-2 4M176 200h72" class="solid"></path><path d="M248 200a8 8 0 0 1 6 4" class="nofill"></path><path d="m254 204 2 4" class="solid"></path><path d="M168 208a16 16 0 0 0 0 16M256 208a16 16 0 0 1 0 16" class="nofill"></path><path d="m168 224 2 4" class="solid"></path><path d="M170 228a8 8 0 0 0 6 4" class="nofill"></path><path d="M176 232h72M256 224l-2 4" class="solid"></path><path d="M254 228a8 8 0 0 1-6 4M48 104a8 8 0 0 0-6 4" class="nofill"></path><path d="m42 108-6 12M48 104h92M52 104v12M140 104v48M36 120h12M36 120v32" class="solid"></path><path d="M52 116a4 4 0 0 1-4 4" class="nofill"></path><path d="M36 152h104" class="solid"></path><path d="M84 160v52" style="stroke-dasharray:8"></path><path d="M84 212a4 4 0 0 0 4 4" class="nofill"></path><path d="M88 216h8" class="solid"></path></svg></p></details>
<h1 id="sources-of-inspiration">Sources of Inspiration</h1>
<p>Ordered by coolness in descending order:</p>
<ol>
<li><a href="https://slama.dev/">slama.dev</a>
<ul>
<li>minimalistic. beautiful</li>
<li>no feedback</li>
</ul>
</li>
<li><a href="https://systemcrafters.net/">systemcrafters.net</a>
<ul>
<li>FOSS-ideology</li>
<li>made with Emacs Org mode</li>
</ul>
</li>
<li><a href="https://www.victorquinn.com/">www.victorquinn.com</a>
<ul>
<li>www?</li>
<li>neat to some degree</li>
</ul>
</li>
<li><a href="https://erika.florist/">erika.florist</a>
<ul>
<li>minimalistic again.</li>
<li>built with Astro.</li>
<li>chaotic a bit.</li>
</ul>
</li>
<li><a href="https://www.seximal.net/">www.seximal.net</a>
<ul>
<li>absurd mess.</li>
<li>autistic confidence. undamaged.</li>
<li>www again.</li>
</ul>
</li>
<li><a href="https://travis.media/">travis.media</a>
<ul>
<li>how not to be</li>
<li>no light/dark scheme</li>
<li>trackers, cookies, mess</li>
</ul>
</li>
</ol>
<h1 id="-repeat">… Repeat</h1>
<div style="display:flex;height:350px;width:350px;background-color:var(--primary-focus);justify-content:center;align-items:center">
      badncamp stub
    </div>
<details><pre class="language-markdown">  <code class="language-markdown"><span class="token front-matter-block"><span class="token punctuation">---</span>
<span class="token front-matter yaml language-yaml">title: "Recursive"
created: 2023-08-08
published: 2023-09-01
id: d2e981e6-2f7f-42e2-9e65-962a0b8c8d9a</span>
<span class="token punctuation">---</span></span>

import Bandcamp from "<span class="token strike"><span class="token punctuation">~</span><span class="token content">/components/Bandcamp.astro";
import Code from "</span><span class="token punctuation">~</span></span>/components/Code.astro";

<span class="token title important"><span class="token punctuation">#</span> Every Thing Originates From a Loop ...</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Bandcamp</span>
  <span class="token attr-name">album</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>601638532<span class="token punctuation">"</span></span>
  <span class="token attr-name">track</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4140453006<span class="token punctuation">"</span></span>
  <span class="token attr-name">artwork</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>small<span class="token punctuation">"</span></span>
  <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>large<span class="token punctuation">"</span></span>
  <span class="token attr-name">minimal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{true}</span>
<span class="token punctuation">/></span></span>

...everything Else is a Remix.

<span class="token title important"><span class="token punctuation">#</span> Concept</span>

Tool to output stuff into public.

<span class="token title important"><span class="token punctuation">##</span> Why? (Motivation)</span>

<span class="token list punctuation">-</span> Artistic expression
<span class="token list punctuation">-</span> Blow off steam

<span class="token title important"><span class="token punctuation">###</span> why Public?</span>

<span class="token list punctuation">-</span> Private already exists
<span class="token list punctuation">-</span> Observer effect
  <span class="token list punctuation">-</span> Experimentation

<span class="token title important"><span class="token punctuation">##</span> Structure</span>

<span class="token list punctuation">-</span> Display Content
  <span class="token list punctuation">-</span> Embeddings (audio, code, diagrams, pictures, video, ...)
  <span class="token list punctuation">-</span> Navigation
<span class="token list punctuation">-</span> Feedback (comments)

<span class="token title important"><span class="token punctuation">#</span> Manifestation</span>

Brief and Simple.

<span class="token title important"><span class="token punctuation">##</span> Base</span>

Web Application.

<span class="token title important"><span class="token punctuation">###</span> Tools</span>

<span class="token title important"><span class="token punctuation">####</span> Engine</span>

<span class="token url">[<span class="token content">Astro</span>](<span class="token url">https://astro.build/</span>)</span>:

<span class="token list punctuation">-</span> Satisfies most of my demands
<span class="token list punctuation">-</span> Provides flexibility to satisfy the rest
<span class="token list punctuation">-</span> Well aligned with contemporaneity principles

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>Some alternatives<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>

<span class="token list punctuation">-</span> Other static website generators:
  <span class="token list punctuation">-</span> <span class="token url">[<span class="token content">Docusaurus</span>](<span class="token url">https://docusaurus.io/</span>)</span> (I don't like React)
  <span class="token list punctuation">-</span> <span class="token url">[<span class="token content">Gatsby</span>](<span class="token url">https://www.gatsbyjs.com/</span>)</span>
  <span class="token list punctuation">-</span> <span class="token url">[<span class="token content">Hugo</span>](<span class="token url">https://gohugo.io/</span>)</span>
<span class="token list punctuation">-</span> Frameworks:
  <span class="token list punctuation">-</span> <span class="token url">[<span class="token content">Rails</span>](<span class="token url">https://rubyonrails.org/</span>)</span>
  <span class="token list punctuation">-</span> <span class="token url">[<span class="token content">Django</span>](<span class="token url">https://www.djangoproject.com/</span>)</span>
  <span class="token list punctuation">-</span> <span class="token url">[<span class="token content">Solid Start</span>](<span class="token url">https://start.solidjs.com/</span>)</span>
<span class="token list punctuation">-</span> <span class="token url">[<span class="token content">PHP</span>](<span class="token url">https://www.php.net/</span>)</span> which, they say, <span class="token url">[<span class="token content">doesn suck that much lately</span>](<span class="token url">https://www.youtube.com/results?search_query=php+doesn%27t+suck</span>)</span>; but I wouldn't care

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>

<span class="token title important"><span class="token punctuation">####</span> Platform</span>

<span class="token list punctuation">-</span> <span class="token url">[<span class="token content">Github</span>](<span class="token url">https://github.com/</span>)</span>
  <span class="token list punctuation">-</span> <span class="token url">[<span class="token content">Repositories</span>](<span class="token url">https://docs.github.com/en/repositories</span>)</span> for code
  <span class="token list punctuation">-</span> <span class="token url">[<span class="token content">Pages</span>](<span class="token url">https://docs.github.com/en/pages</span>)</span> for static hosting
  <span class="token list punctuation">-</span> <span class="token url">[<span class="token content">Discussions</span>](<span class="token url">https://docs.github.com/en/discussions</span>)</span> for feedback
  <span class="token list punctuation">-</span> <span class="token url">[<span class="token content">GraphQL</span>](<span class="token url">https://docs.github.com/en/graphql</span>)</span> for integration
<span class="token list punctuation">-</span> <span class="token url">[<span class="token content">Google Cloud Platform</span>](<span class="token url">https://cloud.google.com/</span>)</span>
  <span class="token list punctuation">-</span> <span class="token url">[<span class="token content">Cloud Functions</span>](<span class="token url">https://cloud.google.com/functions/</span>)</span> for authentication


<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>Some alternatives<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>

<span class="token list punctuation">-</span> For code:
  <span class="token list punctuation">-</span> <span class="token url">[<span class="token content">Codeberg</span>](<span class="token url">https://codeberg.org/</span>)</span>🤗
<span class="token list punctuation">-</span> For static hosting:
  <span class="token list punctuation">-</span> <span class="token url">[<span class="token content">Codeberg's Pages</span>](<span class="token url">https://docs.codeberg.org/codeberg-pages/</span>)</span>
  <span class="token list punctuation">-</span> Netlify
<span class="token list punctuation">-</span> For Feedback:
  <span class="token list punctuation">-</span> <span class="token url">[<span class="token content">ActivityPub</span>](<span class="token url">https://activitypub.rocks/</span>)</span>
    <span class="token list punctuation">-</span> <span class="token url">[<span class="token content">Mastodon</span>](<span class="token url">https://github.com/mastodon/mastodon</span>)</span>?🤨
  <span class="token list punctuation">-</span> <span class="token url">[<span class="token content">SMTP</span>](<span class="token url">https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol</span>)</span> 🥲
<span class="token list punctuation">-</span> Authentication
  <span class="token list punctuation">-</span> AWS Lambdas🤑

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>


<span class="token title important"><span class="token punctuation">##</span> Features</span>

<span class="token title important"><span class="token punctuation">###</span> Display Content</span>

MDX format provides most of the features out of the box:
<span class="token list punctuation">-</span> Embedding pictures
<span class="token list punctuation">-</span> Embedding HTML parts

Some specific cases to be solved on occurrence.


<span class="token title important"><span class="token punctuation">####</span> Diagrams</span>

Structured Information Representation is often the essential for delivery of an idea.

I often think while moving stuff around in a <span class="token url">[<span class="token content">draw.io</span>](<span class="token url">https://app.diagrams.net/</span>)</span>.

Diagrams within website content should be text to graphics.


<span class="token title important"><span class="token punctuation">#####</span> Options</span>

<span class="token title important"><span class="token punctuation">######</span> Mermaid</span>

<span class="token url">[<span class="token content">mermaid-js</span>](<span class="token url">https://mermaid.js.org/</span>)</span> has ready to use
<span class="token url">[<span class="token content">Astro integration</span>](<span class="token url">https://code.juliancataldo.com/component/astro-diagram</span>)</span>
Thanks to <span class="token url">[<span class="token content">Julian Cataldo</span>](<span class="token url">https://github.com/JulianCataldo</span>)</span>.

Downsides:

<span class="token list punctuation">-</span> syntax and diagrams look chaotic
<span class="token list punctuation">-</span> there is very small subset of UML supported
<span class="token list punctuation">-</span> almost no control over layouts
<span class="token list punctuation">-</span> requires puppeteer (i.e. browser) to render text into SVG 🤦‍♂️

Alternative - Remark plugin:

<span class="token list punctuation">-</span> won't eliminate any downsides (mermaid has this complexity flow in its core)
<span class="token list punctuation">-</span> there is more than one options to research


<span class="token title important"><span class="token punctuation">######</span> Graphviz</span>

Robust Versatile C library for Complex Graph Visualizations.

Issues with Color Scheme Preference: in dark mode text is hardly readable.

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>Example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>
<span class="token code"><span class="token punctuation">```</span><span class="token code-language">dot</span>
<span class="token code-block language-dot">digraph G {
  bgcolor="#0000FF44:#FF000044" gradientangle=90
	subgraph cluster_0 {
		style=filled;
		color=lightgrey;
		fillcolor="darkgray:gold";
		gradientangle=0
		node [fillcolor="yellow:green" style=filled gradientangle=270] a0;
		node [fillcolor="lightgreen:red"] a1;
		node [fillcolor="lightskyblue:darkcyan"] a2;
		node [fillcolor="cyan:lightslateblue"] a3;

    	a0 -> a1 -> a2 -> a3;
    	label = "process #1";
    }

    subgraph cluster_1 {
    	node [fillcolor="yellow:magenta"
    		 style=filled gradientangle=270] b0;
    	node [fillcolor="violet:darkcyan"] b1;
    	node [fillcolor="peachpuff:red"] b2;
    	node [fillcolor="mediumpurple:purple"] b3;

    	b0 -> b1 -> b2 -> b3;
    	label = "process #2";
    	color=blue
    	fillcolor="darkgray:gold";
    	gradientangle=0
    	style=filled;
    }
    start -> a0;
    start -> b0;
    a1 -> b3;
    b2 -> a3;
    a3 -> a0;
    a3 -> end;
    b3 -> end;

    start [shape=Mdiamond ,
    	fillcolor="pink:red",
    	gradientangle=90,
    	style=radial];
    end [shape=Msquare,
    	fillcolor="lightyellow:orange",
    	style=radial,
    	gradientangle=90];

}
</span>
<span class="token punctuation">```</span></span>
In light mode this looks okay.
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>Integration<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Code</span>
  <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>typescript<span class="token punctuation">"</span></span>
  <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>src/integrations/graphviz.ts<span class="token punctuation">"</span></span>
<span class="token punctuation">/></span></span>
Thanks to <span class="token url">[<span class="token content">WASM port of Graphviz</span>](<span class="token url">https://github.com/hpcc-systems/hpcc-js-wasm</span>)</span>.
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>


<span class="token title important"><span class="token punctuation">######</span> svgbob</span>

Sweet stuff for dessert.

<span class="token url">[<span class="token content">svgbob</span>](<span class="token url">https://github.com/ivanceras/svgbob</span>)</span> is an ASCII graphics to SVG converter written
in Rust.

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>It is just amazing.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>
<span class="token code"><span class="token punctuation">```</span><span class="token code-language">bob</span>
<span class="token code-block language-bob">.-----------------.
| i love svgbob!  |
'------+ .--------'
       |/      .--------------.
      .-.   .-(  learn  stuff  )
      '+'  /   '--------------'
      /|\-+           ^
      / \  \          |
     Alex   \    .------------.
             '--( make   stuff )
                 '------------'
````

Is encoded with:

```bob
.-----------------.
| i love svgbob!  |
'------+ .--------'
       |/      .--------------.
      .-.   .-(  learn  stuff  )
      '+'  /   '--------------'
      /|\-+           ^
      / \  \          |
     Alex   \    .------------.
             '--( make   stuff )
                 '------------'</span>
<span class="token punctuation">```</span></span>

More examples <span class="token url">[<span class="token content">here</span>](<span class="token url">https://ivanceras.github.io/svgbob-editor/</span>)</span>.

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>The integration of svgbob is almost same easy as graphviz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Code</span>
  <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>typescript<span class="token punctuation">"</span></span>
  <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>src/integrations/svgbob.ts<span class="token punctuation">"</span></span>
<span class="token punctuation">/></span></span>
Thanks to kind people who created <span class="token url">[<span class="token content">svgbob WASM port</span>](<span class="token url">https://github.com/agoose77/svgbob-wasm</span>)</span> and <span class="token url">[<span class="token content">wrapper for it</span>](<span class="token url">https://github.com/fabiospampinato/bob-wasm/tree/master</span>)</span>.

I have just removed style to fit SVG style into the website's style.

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>


<span class="token title important"><span class="token punctuation">#####</span> Summary</span>

<span class="token table"><span class="token table-header-row"><span class="token punctuation">|</span><span class="token table-header important">              </span><span class="token punctuation">|</span><span class="token table-header important"> mermaid  </span><span class="token punctuation">|</span><span class="token table-header important"> graphviz </span><span class="token punctuation">|</span><span class="token table-header important"> svgbob   </span><span class="token punctuation">|</span>
</span><span class="token table-line"><span class="token punctuation">|</span> <span class="token punctuation">------------</span> <span class="token punctuation">|</span> <span class="token punctuation">--------</span> <span class="token punctuation">|</span> <span class="token punctuation">--------</span> <span class="token punctuation">|</span> <span class="token punctuation">--------</span> <span class="token punctuation">|</span>
</span><span class="token table-data-rows"><span class="token punctuation">|</span><span class="token table-data"> usage        </span><span class="token punctuation">|</span><span class="token table-data"> simple   </span><span class="token punctuation">|</span><span class="token table-data"> complex  </span><span class="token punctuation">|</span><span class="token table-data"> tedious  </span><span class="token punctuation">|</span>
<span class="token punctuation">|</span><span class="token table-data"> integration  </span><span class="token punctuation">|</span><span class="token table-data"> complex  </span><span class="token punctuation">|</span><span class="token table-data"> simple   </span><span class="token punctuation">|</span><span class="token table-data"> simple   </span><span class="token punctuation">|</span>
<span class="token punctuation">|</span><span class="token table-data"> flexibility  </span><span class="token punctuation">|</span><span class="token table-data"> fair     </span><span class="token punctuation">|</span><span class="token table-data"> extreme  </span><span class="token punctuation">|</span><span class="token table-data"> hackable </span><span class="token punctuation">|</span>
<span class="token punctuation">|</span><span class="token table-data"> performance  </span><span class="token punctuation">|</span><span class="token table-data"> errgh?.. </span><span class="token punctuation">|</span><span class="token table-data"> fast     </span><span class="token punctuation">|</span><span class="token table-data"> fast     </span><span class="token punctuation">|</span>
<span class="token punctuation">|</span><span class="token table-data"> designation  </span><span class="token punctuation">|</span><span class="token table-data"> frontend </span><span class="token punctuation">|</span><span class="token table-data"> backend  </span><span class="token punctuation">|</span><span class="token table-data"> backend  </span><span class="token punctuation">|</span>
<span class="token punctuation">|</span><span class="token table-data"> productivity </span><span class="token punctuation">|</span><span class="token table-data"> high     </span><span class="token punctuation">|</span><span class="token table-data"> depends  </span><span class="token punctuation">|</span><span class="token table-data"> low      </span><span class="token punctuation">|</span>
</span></span>
All three options can coexist providing their benefits when required.

However, I have not been completely satisfied by neither of them and feel an urge to
experiment with text to diagram myself. Hopefully I will find time.


<span class="token title important"><span class="token punctuation">####</span> Music (Bandcamp)</span>

Cross origin policy should prevent some tracking.

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>The integration<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Code</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>typescript<span class="token punctuation">"</span></span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>src/components/Bandcamp.astro<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>

Killswitch is needed to keep console clear from CORS errors.

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>


<span class="token title important"><span class="token punctuation">###</span> Navigation (Preview)</span>


<span class="token title important"><span class="token punctuation">####</span> Page Types</span>

<span class="token list punctuation">1.</span> Article (is a Content Item)
<span class="token list punctuation">2.</span> List of Content Item Previews


<span class="token title important"><span class="token punctuation">####</span> Display Rules</span>

<span class="token list punctuation">*</span> Each article has an Id to match with any bound resources (e.g. Discussion)
<span class="token list punctuation">*</span> If List Page contains single Item Preview, redirect to that Item instead of showing it


<span class="token title important"><span class="token punctuation">####</span> Preprocessing</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>Vite plugin to embed Ids and generate Previews.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Code</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>typescript<span class="token punctuation">"</span></span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>src/integrations/vite.ts<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token code-snippet code keyword">`src/content/config.ts`</span> appears in Vite's <span class="token code-snippet code keyword">`load`</span> hook each time content changes.
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>


<span class="token title important"><span class="token punctuation">###</span> Feedback</span>

Discussions bound to content.


<span class="token title important"><span class="token punctuation">####</span> Why?</span>

<span class="token list punctuation">-</span> Rational:

  Feedback is important part of any system.

  If a system is not capable of receiving a feedback it is singular, i.e. does not have
  volume. Lack of volume makes it a "ghost": removes its ability to interact with
  environment.

<span class="token list punctuation">-</span> Irrational:

  I want to do it myself to have better control over the ways data handled.


<span class="token title important"><span class="token punctuation">####</span> How?</span>

<span class="token list punctuation">-</span> Use Github discussions to persist data.

<span class="token list punctuation">-</span> Integrate with project:

  User and Repository from origin URL are part of configuration

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>Some ready to use alternatives<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>

<span class="token list punctuation">-</span> <span class="token url">[<span class="token content">giscus</span>](<span class="token url">https://github.com/giscus/giscus/</span>)</span>
<span class="token list punctuation">-</span> <span class="token url">[<span class="token content">utterances</span>](<span class="token url">https://github.com/utterance/utterances</span>)</span>
<span class="token list punctuation">-</span> <span class="token url">[<span class="token content">Gitalk</span>](<span class="token url">https://github.com/gitalk/gitalk</span>)</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>

<span class="token code"><span class="token punctuation">```</span><span class="token code-language">bob</span>
<span class="token code-block language-bob">      .-.
      '+'                  +-----------+          +--------------+                 +-------------+
     --+--                 |           |          |              |                 |             |
       |                   | Website   |          |   Github     |                 |   Server    |
      / \                  |           |          |              |                 |             |
     /   \                 +-----+-----+          +-------+------+                 +------+------+
     User                        |                        |                               |
       |
                                 |                        |                               |
       |
      +++  access   comments     |                        |                               |
      | |---------------------->+++
      | |    go  to  Github     | |                                                       |
      | |&lt;- - - - - - - - - - - +++                       |
      | |                        |                                                        |
      | |----------------------------------------------->+-+
      | |                        |                       | |                              |
 + - -| | - - - - - - - - - - - - - - - - - - - - - - - -| |- -+
 | if  Github  session  expired  |                       | |   |                          |
      | |                                                | |
 |    | |     do   you   authorize   this   Website?    +++|   |                          |
      | |&lt;----------------------------------------------| ||
 |    | |                 yeah ,  sure                  | ||   |                          |
      | |- - - - - - - - - - - - - - - - - - - - - - - >+++|
 |    | |                        |                       | |   |                          |
 + - -| |- - - - - - - - - - - - - - - - - - - - - - - - | | - +
      | |                        |      Auth   Code      | |                              |
      | |                       +++&lt;- - - - - - - - - - -+++
      | |                       | | issue   me   a   token,   I   have   Auth   Code      |
      | |                       | |----------------------------------------------------->+++
      | |                       | |                       |    Auth   Code   +   Secret  | |
      | |                       | |                      +++&lt;----------------------------| |
      | |                       | |                      | |   Auth   Token              | |
      | |                       | |                      +++- - - - - - - - - - - - - - >| |
      | |                       | |        Auth   Token   |                              | |
      | |                       | |&lt;- - - - - - - - - - - - - - - - - - - - - - - - - - -+++
      | |                       | |                       |                               |
      | |                       | |
      | |                       | |                       |
      | |                       | |                                                +------------+
      | |                       | |        Auth   Token   |                        |            |
      | |                       +++----------------------------------------------->|  GraphQL   |
      | |                        |                        |                        |            |
      | | show   me   data       |                                                 +------+-----+
      | |---------------------->+++  get me data          |                               |
      | |                       | |----------------------------------------------------->+++
      | |                       | |                       |   request   +  Auth  Token   | |
      | |                       | |                      +++&lt;----------------------------| |
      | |                       | |                      | |  response  with  data       | |
      | |                       | |                      +++- - - - - - - - - - - - - - >| |
      | |                       | |     data                                             | |
      | |  data   view          | |&lt;- - - - - - - - - - - - - - - - - - - - - - - - - - -+++
      | |&lt; - - - - - - - - - - -+++                                                       |
      | |                        |
      +++                                                                                 |
       |                         |</span>
<span class="token punctuation">```</span></span>


<span class="token title important"><span class="token punctuation">####</span> Authentication</span>

Microservice for <span class="token url">[<span class="token content">OAuth Code Grant</span>](<span class="token url">https://datatracker.ietf.org/doc/html/rfc6749#section-4.1</span>)</span> flow

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>Alternative<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>

<span class="token url">[<span class="token content">Github Apps</span>](<span class="token url">https://docs.github.com/en/apps</span>)</span>:

<span class="token list punctuation">-</span> requires a bit more complicated backend
<span class="token list punctuation">-</span> allows fine-grained permissions settings => more secure
<span class="token list punctuation">-</span> non-standard (comparing to standardized OAuth2 framework)

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>Client-side Authentication<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>

Discussions are <span class="token code-snippet code keyword">`client:only`</span>.

Github-harness is provided as <span class="token entity named-entity" title="&lt;">&amp;lt;</span>Github/<span class="token entity named-entity" title="&gt;">&amp;gt;</span> component. It follows semantics of
<span class="token url">[<span class="token content">Solid's &amp;lt;Show/&amp;gt;</span>](<span class="token url">https://www.solidjs.com/docs/latest/api#show</span>)</span>:

<span class="token code"><span class="token punctuation">```</span><span class="token code-language">jsx</span>
<span class="token code-block language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Github</span></span>
  <span class="token attr-name">fallback</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">LoginButton</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token comment">/* render login UI here */</span>
  <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
  <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>clientConfiguration<span class="token punctuation">}</span></span>
<span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">client<span class="token punctuation">,</span> LogoutButton</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token comment">/* use client to fetch data for UI */</span>
  <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Github</span></span><span class="token punctuation">></span></span></span>
<span class="token punctuation">```</span></span>

<span class="token list punctuation">-</span> Access Token is only in memory of that component.
<span class="token list punctuation">-</span> If page is refreshed, token is gone.

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Code</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tsx<span class="token punctuation">"</span></span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>src/components/Github.tsx<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>Server-side Authentication<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>

<span class="token list punctuation">1.</span> Cloud function is <span class="token url">[<span class="token content">cost efficient for such tasks</span>](<span class="token url">https://cloud.google.com/functions/pricing</span>)</span>:

   Considering amount of expected visitors equal to zero, it should be free.

<span class="token list punctuation">2.</span> GCP Secret Manager is used to store Client Secret

   <span class="token list punctuation">-</span> Delegation is a profitable strategy when applied wisely☝

   <span class="token list punctuation">-</span> Storing small amount of secrets <span class="token url">[<span class="token content">is also almost free in GCP</span>](<span class="token url">https://cloud.google.com/secret-manager/pricing</span>)</span>

Prerequisites:

<span class="token list punctuation">-</span> <span class="token url">[<span class="token content">Create OAuth application on Github</span>](<span class="token url">https://github.com/settings/developers</span>)</span>

  <span class="token list punctuation">-</span> Set <span class="token code-snippet code keyword">`github_client_secret`</span> in GCP Secret Manager

<span class="token code keyword">    Secret Manager should contain `github_client_secret` with `latest` version value
    corresponding to the actual Client Secret provided by Github</span>

  <span class="token list punctuation">-</span> Set <span class="token code-snippet code keyword">`GITHUB_OAUTH_CLIENT_ID`</span> environment variable

<span class="token list punctuation">-</span> Service Account (by default - App Engine's default SA) which executes cloud
  function MUST have role "Secret Manager Secret Accessor"

  > <span class="token bold"><span class="token punctuation">**</span><span class="token content">NOTE:</span><span class="token punctuation">**</span></span> It should be possible to setup fine-grained rules for each role, but for me
  > it did not work for a specific secret name

<span class="token list punctuation">-</span> Set <span class="token code-snippet code keyword">`BASE_URL`</span> environment variable

  > <span class="token bold"><span class="token punctuation">**</span><span class="token content">ATTENTION:</span><span class="token punctuation">**</span></span> One may fail a part, but ought to chamfer it.
  > Same with security: don't neglect CORS, set exact URLs in policy headers.

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Code</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>go<span class="token punctuation">"</span></span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>auth/github-oauth2.gcf.go<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

Why go? - It's the fastest available.

Deployment script:

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Code</span>
  <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sh<span class="token punctuation">"</span></span>
  <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>auth/deploy.sh<span class="token punctuation">"</span></span>
<span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>


<span class="token title important"><span class="token punctuation">####</span> Github GraphQL Client</span>

Inception: <span class="token url">[<span class="token content">Github's GraphQL Explorer</span>](<span class="token url">https://docs.github.com/en/graphql/overview/explorer</span>)</span>.


<span class="token title important"><span class="token punctuation">#####</span> Tools</span>

<span class="token list punctuation">-</span> <span class="token url">[<span class="token content">@graphql-codegen/cli</span>](<span class="token url">https://the-guild.dev/graphql/codegen</span>)</span> to bind schema to code

<span class="token list punctuation">-</span> <span class="token url">[<span class="token content">URQL</span>](<span class="token url">https://formidable.com/open-source/urql/</span>)</span> to execute requests

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>Alternatives<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>

<span class="token list punctuation">-</span> <span class="token url">[<span class="token content">@octokit/graphql</span>](<span class="token url">https://github.com/octokit/graphql.js/</span>)</span>

  does not bring any benefits comparing to standard <span class="token url">[<span class="token content">Fetch API</span>](<span class="token url">https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API</span>)</span>

<span class="token list punctuation">-</span> <span class="token url">[<span class="token content">Apollo</span>](<span class="token url">https://www.apollographql.com/</span>)</span>

  for shooting sparrows from a cannon

<span class="token list punctuation">-</span> <span class="token url">[<span class="token content">graphql-zeus</span>](<span class="token url">https://github.com/graphql-editor/graphql-zeus</span>)</span>

  neat, but brings in vulnerabilities

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>Schema caching<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Code</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sh<span class="token punctuation">"</span></span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>update-github-schema.sh<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>


<span class="token title important"><span class="token punctuation">#####</span> Client operations</span>

In order to satisfy basic commenting use case, I have created few GraphQL files.

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>Add Discussion Comment<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>
  Invoked when user clicks "comment" button.
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Code</span>
    <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>graphql<span class="token punctuation">"</span></span>
    <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>src/integrations/github/graphql/AddDiscussionComment.graphql<span class="token punctuation">"</span></span>
  <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>Create Discussion<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>
  Invoked during static website generation to create discussion for newly published
  content.
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Code</span>
    <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>graphql<span class="token punctuation">"</span></span>
    <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>src/integrations/github/graphql/CreateDiscussion.graphql<span class="token punctuation">"</span></span>
  <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>Get Discussion Comments<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>
  Invoked when user is authorized to work with Github client.
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Code</span>
    <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>graphql<span class="token punctuation">"</span></span>
    <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>src/integrations/github/graphql/GetDiscussionComments.graphql<span class="token punctuation">"</span></span>
  <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>Get Discussions<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>
  Invoked during static website generation to provide all discussions that are already
  there.
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Code</span>
    <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>graphql<span class="token punctuation">"</span></span>
    <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>src/integrations/github/graphql/GetDiscussions.graphql<span class="token punctuation">"</span></span>
  <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>Get Ids Of Repository And Discussion Category<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>
  Invoked during static website generation to provide all discussions that are already
  there.
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Code</span>
    <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>graphql<span class="token punctuation">"</span></span>
    <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>src/integrations/github/graphql/GetIdsOfRepositoryAndDiscussionCategory.graphql<span class="token punctuation">"</span></span>
  <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>

All generated code is ignored by git.


<span class="token title important"><span class="token punctuation">######</span> TODO</span>

<span class="token list punctuation">-</span> Live comments: use GraphQL subscriptions

<span class="token list punctuation">-</span> Transparent Title:

  <span class="token list punctuation">-</span> Human-Readable titles in Github discussions

  <span class="token list punctuation">-</span> Heuristics to match Content with Discussion

  <span class="token list punctuation">-</span> Transformers to update existing data

<span class="token list punctuation">-</span> Support Replies

<span class="token title important"><span class="token punctuation">###</span> Fanciness</span>

<span class="token list punctuation">-</span> <span class="token url">[<span class="token content">PicoCSS framework</span>](<span class="token url">https://picocss.com/</span>)</span> brings style to semantic markup.

<span class="token list punctuation">-</span> Minimal customizations for c9e

<span class="token list punctuation">-</span> PicoCSS may be fully replaced or adapted later; semantic markup will stay

<span class="token title important"><span class="token punctuation">####</span> Color Scheme Preference</span>

<span class="token list punctuation">-</span> <span class="token code-snippet code keyword">`default`</span> is determined with media-query feature
  <span class="token url">[<span class="token content">prefers-color-scheme</span>](<span class="token url">https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-color-scheme</span>)</span>

<span class="token list punctuation">-</span> <span class="token url">[<span class="token content">PicoCSS framework</span>](<span class="token url">https://picocss.com/</span>)</span> handles it out of the box

<span class="token list punctuation">-</span> Source code embeddings require separate implementation of color scheme preference

  Astro Default - <span class="token url">[<span class="token content">Shiki</span>](<span class="token url">https://github.com/shikijs/shiki</span>)</span> does not allow to handle runtime
  color change.

  Alternative - <span class="token url">[<span class="token content">Prism</span>](<span class="token url">https://prismjs.com/</span>)</span> is less functional, but easier to support
  color scheme preference

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>Implementation Code<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Code</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>html<span class="token punctuation">"</span></span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>src/components/Code.astro<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">></span></span>TODO<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">></span></span>
<span class="token list punctuation">-</span> Manual override with a button/toggle:

<span class="token code"><span class="token punctuation">```</span><span class="token code-language">bob</span>
<span class="token code-block language-bob">                         .-.
                         '+'
                          |
                          | load
                          V
                     .---------.
     .+----------+  ( default   )&lt;---.
    /-'          |   '---------'     |
    | persisted  |        |          |
    +------+-----+        |          |
          :        toggle |   toggle |
          :               V          |
          :          .---------.     |
          '- - - - -( override  )----'
                     '---------'</span>
<span class="token punctuation">```</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>


<span class="token title important"><span class="token punctuation">#</span> Sources of Inspiration</span>

Ordered by coolness in descending order:

<span class="token list punctuation">1.</span>  <span class="token url">[<span class="token content">slama.dev</span>](<span class="token url">https://slama.dev/</span>)</span>
    <span class="token list punctuation">-</span> minimalistic. beautiful
    <span class="token list punctuation">-</span> no feedback
<span class="token list punctuation">2.</span>  <span class="token url">[<span class="token content">systemcrafters.net</span>](<span class="token url">https://systemcrafters.net/</span>)</span>
    <span class="token list punctuation">-</span> FOSS-ideology
    <span class="token list punctuation">-</span> made with Emacs Org mode
<span class="token list punctuation">3.</span>  <span class="token url">[<span class="token content">www.victorquinn.com</span>](<span class="token url">https://www.victorquinn.com/</span>)</span>
    <span class="token list punctuation">-</span> www?
    <span class="token list punctuation">-</span> neat to some degree
<span class="token list punctuation">4.</span>  <span class="token url">[<span class="token content">erika.florist</span>](<span class="token url">https://erika.florist/</span>)</span>
    <span class="token list punctuation">-</span> minimalistic again.
    <span class="token list punctuation">-</span> built with Astro.
    <span class="token list punctuation">-</span> chaotic a bit.
<span class="token list punctuation">5.</span>  <span class="token url">[<span class="token content">www.seximal.net</span>](<span class="token url">https://www.seximal.net/</span>)</span>
    <span class="token list punctuation">-</span> absurd mess.
    <span class="token list punctuation">-</span> autistic confidence. undamaged.
    <span class="token list punctuation">-</span> www again.
<span class="token list punctuation">6.</span>  <span class="token url">[<span class="token content">travis.media</span>](<span class="token url">https://travis.media/</span>)</span>
    <span class="token list punctuation">-</span> how not to be
    <span class="token list punctuation">-</span> no light/dark scheme
    <span class="token list punctuation">-</span> trackers, cookies, mess

<span class="token title important"><span class="token punctuation">#</span> ... Repeat</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Bandcamp</span> <span class="token attr-name">album</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>601638532<span class="token punctuation">"</span></span> <span class="token attr-name">track</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1954792515<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>large<span class="token punctuation">"</span></span> <span class="token attr-name">minimal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{true}</span> <span class="token punctuation">/></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>details</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Code</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>markdown<span class="token punctuation">"</span></span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>src/content/articles/recursive.mdx<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>details</span><span class="token punctuation">></span></span>
</code>
</pre></details>
  </main>
  
</article>
  <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();;(()=>{var d;{let p={0:t=>u(t),1:t=>l(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(l(t)),5:t=>new Set(l(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},h=t=>{let[e,n]=t;return e in p?p[e](n):void 0},l=t=>t.map(h),u=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([e,n])=>[e,h(n)]));customElements.get("astro-island")||customElements.define("astro-island",(d=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=async()=>{var i;if(!this.hydrator||!this.isConnected)return;let e=(i=this.parentElement)==null?void 0:i.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let n=this.querySelectorAll("astro-slot"),o={},a=this.querySelectorAll("template[data-astro-template]");for(let r of a){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of n){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(o[r.getAttribute("name")||"default"]=r.innerHTML)}let c;try{c=this.hasAttribute("props")?u(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",y=this.getAttribute("component-export");throw y&&(s+=` (export ${y})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}await this.hydrator(this)(this.Component,c,o,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((e,n)=>{n.disconnect(),setTimeout(()=>this.childrenConnectedCallback(),0)}).observe(this,{childList:!0})}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}start(){let e=JSON.parse(this.getAttribute("opts")),n=this.getAttribute("client");if(Astro[n]===void 0){window.addEventListener(`astro:${n}`,()=>this.start(),{once:!0});return}Astro[n](async()=>{let o=this.getAttribute("renderer-url"),[a,{default:c}]=await Promise.all([import(this.getAttribute("component-url")),o?import(o):()=>()=>{}]),i=this.getAttribute("component-export")||"default";if(!i.includes("."))this.Component=a[i];else{this.Component=a;for(let r of i.split("."))this.Component=this.Component[r]}return this.hydrator=c,this.hydrate},e,this)}attributeChangedCallback(){this.hydrate()}},d.observedAttributes=["props"],d))}})();</script><astro-island uid="1pyL7b" component-url="/_astro/Discussion.29f5c20c.js" component-export="default" renderer-url="/_astro/client.3918311a.js" props="{&quot;location&quot;:[0,&quot;/articles/recursive&quot;],&quot;clientId&quot;:[0,&quot;074854c2cb8660d09638&quot;],&quot;authURL&quot;:[0,&quot;https://us-central1-public-395621.cloudfunctions.net/oauth2&quot;],&quot;user&quot;:[0,&quot;abetaev&quot;],&quot;repo&quot;:[0,&quot;test&quot;],&quot;id&quot;:[0,&quot;D_kwDOKE_ch84AVIxV&quot;]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;Discussion&quot;,&quot;value&quot;:true}"></astro-island>

    </main>
    <footer>
      <nav>
  <ul></ul>
  <ul>
    <li>
          <a role="button" href="/" data-icon-gmso="home"></a>
        </li>
    <li>
      <a role="button" href="https://github.com/abetaev/test" data-icon-name="github-dark"></a>
    </li>
    <li>
      <a role="button" href="https://bandcamp.com/abetaev" data-icon-name="bandcamp-dark"></a>
    </li>
  </ul>
  <ul></ul>
</nav>
    </footer>
  </body></html>